<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual Review Submitter - Reputifly</title>
    <link rel="icon" type="image/png" href="https://media.licdn.com/dms/image/v2/D560BAQEScnUkJITXAg/company-logo_200_200/B56ZajOckKHsAI-/0/1746495195792?e=2147483647&v=beta&t=Z7yQpp5jSwm-De46D45WIC5fY_2w0GVgEWLoEOM1aug">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        // Define the callback function in the global scope right here in the <head>.
        function initializeGoogleMaps() {
            if (window.reviewApp) {
                window.reviewApp.mapsApiLoaded();
            } else {
                setTimeout(initializeGoogleMaps, 100);
            }
        }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXdjRQZJd9ySH5mxql4tlXCEVpDH9GGbI&libraries=places&callback=initializeGoogleMaps"></script>
    <style>
        :root {
            --bg-primary: #020010;
            --bg-secondary: #11072C;
            --accent-primary: #A855F7; /* Purple */
            --accent-secondary: #EC4899; /* Pink */
            --text-primary: #E5E7EB;
            --text-secondary: #9CA3AF;
            --border-color: rgba(168, 85, 247, 0.2);
            --error-color: #f87171; /* Red for errors */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* Animated Gradient Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 15% 25%, rgba(168, 85, 247, 0.15) 0%, transparent 40%),
                        radial-gradient(circle at 85% 75%, rgba(236, 72, 153, 0.15) 0%, transparent 40%);
            animation: background-pan 20s linear infinite;
        }

        @keyframes background-pan {
            0% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
            100% { background-position: 0% 0%; }
        }

        /* Invisible Scrollbar */
        ::-webkit-scrollbar { display: none; }
        body { -ms-overflow-style: none; scrollbar-width: none; }


        /* Main Container & Card Styles */
        .polished-container, .review-item {
            background: rgba(17, 7, 44, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
        }
        
        .polished-container.has-error {
            border-color: var(--error-color);
            box-shadow: 0 0 15px rgba(248, 113, 113, 0.3);
        }

        /* Aurora Glow Effect on Hover */
        .polished-container::after, .review-item::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(168, 85, 247, 0.2) 0%, transparent 40%);
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.5s ease;
            z-index: 0;
            opacity: 0;
        }
        .polished-container:hover::after, .review-item:hover::after {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
        .polished-container > *, .review-item > * {
            position: relative;
            z-index: 1;
        }

        .polished-container:hover {
            border-color: rgba(168, 85, 247, 0.5);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3), 0 0 20px rgba(168, 85, 247, 0.2);
        }

        /* Button Styles */
        .button-gradient {
            background-image: linear-gradient(to right, var(--accent-primary), var(--accent-secondary));
            background-size: 200% auto;
            transition: all 0.4s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: none;
            color: white;
            font-weight: 600;
        }
        .button-gradient:hover {
            background-position: right center;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4), 0 0 15px rgba(236, 72, 153, 0.3);
        }
        .button-secondary {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        .button-secondary:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-primary);
        }

        /* Input & Textarea Styles */
        input[type="text"], input[type="password"], input[type="number"], textarea, pre {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            color: var(--text-primary);
            transition: all 0.3s ease;
            width: 100%;
        }
        input[type="text"]:focus, input[type="password"]:focus, input[type="number"]:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.3);
            background-color: #1a0c3d;
        }

        /* Animations */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in-down { animation: fadeInDown 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards; }

        /* Notification Toast - TOP CENTER */
        #notification-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10001;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        .notification-toast {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            border-radius: 0.75rem;
            color: white;
            font-weight: 500;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.37);
            transform: translateY(-150%);
            opacity: 0;
            transition: transform 0.5s cubic-bezier(0.215, 0.610, 0.355, 1), opacity 0.5s ease;
        }
        .notification-toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        .notification-toast.success { background: rgba(16, 185, 129, 0.5); }
        .notification-toast.error { background: rgba(239, 68, 68, 0.5); }
        .notification-toast.info { background: rgba(59, 130, 246, 0.5); }


        /* Other UI Polish */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        button:disabled, input:disabled, textarea:disabled { opacity: 0.4; cursor: not-allowed; }
        .pac-container {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            color: var(--text-primary);
            z-index: 10000 !important;
            font-family: 'Inter', sans-serif;
            backdrop-filter: blur(5px);
        }
        .pac-item { padding: 0.75rem; cursor: pointer; border-top: 1px solid var(--border-color); }
        .pac-item:first-child { border-top: none; }
        .pac-item:hover { background-color: rgba(168, 85, 247, 0.1); }
        .pac-item-query { font-weight: 600; color: white; }
        
        .sticky-header {
            position: sticky;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 50;
            background-color: rgba(2, 0, 16, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-color);
        }
    </style>
</head>
<body class="min-h-screen">

    <div id="app" class="pb-40">
        <div class="sticky-header">
            <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-center py-4">
                    <img src="https://reputifly.com/wp-content/uploads/2025/05/cropped-reputifly-new-e1746390492876.png" alt="Reputifly Logo" class="h-8 sm:h-9">
                </div>
            </div>
        </div>
        <div id="manual-view" class="pt-10 px-4 sm:px-6 lg:px-8 max-w-screen-2xl mx-auto"></div>
    </div>

    <!-- Modals and Notifications -->
    <div id="notification-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const app = {
                // --- STATE ---
                state: {
                    mapsInitialized: false,
                    selectedPlace: {},
                    reviews: [],
                    bulkText: '',
                },
                // --- DOM ELEMENTS ---
                elements: {
                    app: document.getElementById('app'),
                    manualView: document.getElementById('manual-view'),
                    notificationContainer: document.getElementById('notification-container'),
                },
                // --- INITIALIZATION ---
                init() {
                    window.reviewApp = this;
                    this.resetState(false);
                    this.attachListeners();
                    this.render();
                    setTimeout(() => this.initializeMaps(), 100);
                },

                mapsApiLoaded() {
                    this.state.mapsInitialized = true;
                    this.initializeMaps();
                },

                initializeMaps() {
                    if (!this.state.mapsInitialized) return;
                    this.initAutocomplete('manual-link-input', this.handlePlaceSelection.bind(this));
                },

                // --- GOOGLE MAPS & PLACES INTEGRATION ---
                initAutocomplete(inputId, callback) {
                    const input = document.getElementById(inputId);
                    if (!input || input.dataset.acAttached) return;

                    const autocompleteOptions = {
                        fields: ["place_id", "name", "url"],
                        types: ["establishment"]
                    };
                    const autocomplete = new google.maps.places.Autocomplete(input, autocompleteOptions);
                    input.dataset.acAttached = 'true';

                    autocomplete.addListener('place_changed', () => {
                        const place = autocomplete.getPlace();
                        callback(place);
                    });
                },

                handlePlaceSelection(place) {
                    if (!place || !place.place_id) {
                        this.showNotification("Could not retrieve company details. Please try again.", "error");
                        return;
                    }

                    this.state.selectedPlace.name = place.name || '';
                    this.state.selectedPlace.reviewLink = `https://search.google.com/local/writereview?placeid=${place.place_id}`;
                    
                    this.showNotification(`Selected: ${place.name}`, "success");
                    this.render();
                },

                // --- RENDERING ---
                render() {
                    this.elements.manualView.innerHTML = this.renderManualView();
                    // Re-initialize maps after render, important for when the view changes
                    setTimeout(() => this.initializeMaps(), 0);
                },

                renderManualView() {
                    const { selectedPlace, reviews, bulkText } = this.state;
                    const isPlaceSelected = !!selectedPlace.reviewLink;
                    const areReviewsProcessed = reviews.length > 0;
                    
                    return `
                        <div class="max-w-5xl mx-auto space-y-8">
                            <div id="owner-link-section" class="p-6 polished-container">
                                 <h2 class="text-xl font-semibold text-white mb-4">Step 1: Find Business</h2>
                                 <div class="relative">
                                    <svg class="absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                                    <input type="text" id="manual-link-input" class="py-3 pr-3 pl-12" placeholder="Search with Google..." value="${selectedPlace.name || ''}">
                                 </div>
                                 ${isPlaceSelected ? `<p class="text-sm text-green-400 mt-3">Review Link: <a href="${selectedPlace.reviewLink}" target="_blank" class="underline hover:text-green-300 break-all">${selectedPlace.reviewLink}</a></p>` : ''}
                            </div>
                            
                            ${isPlaceSelected ? `
                                <div id="owner-bulk-section" class="p-6 polished-container ${areReviewsProcessed ? 'hidden' : ''}">
                                    <h2 class="text-xl font-semibold text-white mb-4">Step 2: Paste Reviews</h2>
                                    <p class="text-sm text-gray-400 mb-3">Paste reviews here to process them manually, one per line.</p>
                                    <textarea id="owner-bulk-textarea" class="p-3 h-60 resize-y no-scrollbar" placeholder="Example:\n\nThis place is amazing!\nGreat service and friendly staff.\nI highly recommend it.">${bulkText}</textarea>
                                    <div id="bulk-text-error" class="text-red-400 text-sm mt-2 hidden"></div>
                                    <button id="process-bulk-reviews-btn" class="mt-4 w-full button-gradient py-3 px-4 rounded-lg">Process Reviews</button>
                                </div>
                                
                                <div id="owner-reviews-section" class="p-6 polished-container ${!areReviewsProcessed ? 'hidden' : ''}">
                                    <div class="mb-6 flex flex-wrap justify-between items-center gap-4">
                                        <h2 class="text-xl font-semibold text-white">Processed Reviews (${reviews.length}) - Ready to Download</h2>
                                        <div class="flex items-center gap-3">
                                            <button id="reset-reviews-btn" class="button-secondary font-bold py-2 px-4 rounded-lg">Start Over</button>
                                            <button class="download-file-btn button-gradient py-2 px-4 rounded-lg">Download File</button>
                                        </div>
                                    </div>
                                    <div id="owner-reviews-container" class="max-h-[60vh] lg:max-h-[calc(100vh-250px)] overflow-y-auto pr-2 no-scrollbar">${this.renderReviewCards()}</div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                },

                renderReviewCards() {
                    const { reviews } = this.state;
                    if (reviews.length === 0) return '';
                    return reviews.map((review, index) => `
                        <div class="review-item p-5 mb-4">
                            <div class="flex justify-between items-start mb-3">
                                <span class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-500">#${index + 1}</span>
                                <button data-index="${index}" class="remove-review-btn text-gray-500 hover:text-red-500 font-bold text-2xl leading-none p-1">&times;</button>
                            </div>
                            <textarea data-index="${index}" class="content-input p-3 h-24 resize-y no-scrollbar">${review.text}</textarea>
                        </div>
                    `).join('');
                },

                // --- EVENT LISTENERS & HANDLERS ---
                attachListeners() {
                    this.elements.app.addEventListener('click', e => this.handleClick(e));
                    this.elements.app.addEventListener('input', e => this.handleInput(e));
                },

                handleClick(e) {
                    const target = e.target.closest('#process-bulk-reviews-btn, #reset-reviews-btn, .download-file-btn, .remove-review-btn');
                    if (!target) return;

                    if (target.matches('#process-bulk-reviews-btn')) this.processBulkReviews();
                    if (target.matches('#reset-reviews-btn')) this.resetState();
                    if (target.matches('.download-file-btn')) this.triggerDownload();
                    if (target.matches('.remove-review-btn')) {
                        this.state.reviews.splice(target.dataset.index, 1);
                        this.render();
                    }
                },

                handleInput(e) {
                    const target = e.target;
                    if (target.id === 'owner-bulk-textarea') {
                        this.state.bulkText = target.value;
                        // Hide error message on input
                        const errorEl = document.getElementById('bulk-text-error');
                        const containerEl = target.closest('.polished-container');
                        if (errorEl && containerEl) {
                            errorEl.classList.add('hidden');
                            containerEl.classList.remove('has-error');
                        }
                    }
                    if (target.classList.contains('content-input')) {
                        this.state.reviews[target.dataset.index].text = target.value;
                    }
                },

                // --- CORE LOGIC ---
                processBulkReviews() {
                    const { bulkText } = this.state;
                    const errorEl = document.getElementById('bulk-text-error');
                    const containerEl = document.getElementById('owner-bulk-section');

                    if (!bulkText.trim()) {
                        errorEl.textContent = 'Please paste at least one review into the text box before processing.';
                        errorEl.classList.remove('hidden');
                        containerEl.classList.add('has-error');
                        this.showNotification("Input error: Text area is empty.", 'error');
                        return;
                    }
                    
                    errorEl.classList.add('hidden');
                    containerEl.classList.remove('has-error');

                    const lines = bulkText.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                    const uniqueLines = [...new Set(lines)];
                    
                    if (uniqueLines.length === 0) { 
                        this.showNotification("No valid reviews found to process.", "error"); 
                        return; 
                    }

                    this.state.reviews = uniqueLines.map(line => ({ text: line }));
                    this.showNotification(`${uniqueLines.length} unique reviews processed.`, "success");
                    this.render();
                },

                triggerDownload() {
                    const filename = this.state.selectedPlace.name || 'reviews';
                    const data = { 
                        link: this.state.selectedPlace.reviewLink, 
                        reviews: this.state.reviews.map(r => ({text: r.text, requiresImage: false})) 
                    };
                    const dataBlob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${filename.replace(/\s+/g, '_')}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    this.showNotification(`File '${a.download}' downloaded!`);
                },

                // --- UTILITIES ---
                resetState(shouldRender = true) {
                    this.state.selectedPlace = {};
                    this.state.reviews = [];
                    this.state.bulkText = '';
                    if (shouldRender) this.render();
                },

                copyToClipboard(text, message = "Copied to clipboard!") {
                    navigator.clipboard.writeText(text).then(() => {
                        this.showNotification(message);
                    }, () => {
                        this.showNotification("Failed to copy.", 'error');
                    });
                },

                showNotification(message, type = 'success') {
                    const id = `toast-${Date.now()}`;
                    const toast = document.createElement('div');
                    toast.id = id;
                    toast.className = `notification-toast ${type}`;

                    const icons = {
                        success: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
                        error: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
                        info: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`
                    };

                    toast.innerHTML = `${icons[type] || ''}<span>${message}</span>`;
                    this.elements.notificationContainer.appendChild(toast);

                    // Animate in
                    setTimeout(() => toast.classList.add('show'), 10);

                    // Animate out and remove
                    setTimeout(() => {
                        toast.classList.remove('show');
                        toast.addEventListener('transitionend', () => toast.remove());
                    }, 4000);
                }
            };

            app.init();
        });
    </script>
</body>
</html>
