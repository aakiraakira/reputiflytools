<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en" class="reputify-theme"><head>
    
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reputifly | AI Note Taker</title>
    <link rel="icon" type="image/png" href="https://media.licdn.com/dms/image/v2/D560BAQEScnUkJITXAg/company-logo_200_200/B56ZajOckKHsAI-/0/1746495195792?e=2147483647&amp;v=beta&amp;t=Z7yQpp5jSwm-De46D45WIC5fY_2w0GVgEWLoEOM1aug" />
    <meta name="theme-color" id="theme-color-meta" content="#100F1B" />
    
    <style type="text/tailwindcss" id="tailwind-inline">
        /* --- Base &amp; Color Variables --- */

        :root {
            --bg-main: #FFFFFF;
            --bg-pane-light: #F9F9F9;
            --bg-pane-dark: #F4F4F4;
            --text-primary: #1a1a1a;
            --text-secondary: #555555;
            --text-tertiary: #888888;
            --accent-primary: #007aff;
            --accent-primary-dark: #007aff;
            --border-color: #EAEAEA;
            --shadow-color: rgba(0, 0, 0, 0.05);
            --brand-grad-from: #007aff;
            --brand-grad-to: #007aff;
            --hairline: color-mix(in srgb, var(--text-primary) 8%, transparent);
--glass-bg: color-mix(in srgb, var(--bg-main) 75%, transparent);
--glass-elevated: color-mix(in srgb, var(--bg-pane-dark) 65%, transparent);

        }
        

        .dark {
            --bg-main: #111827;
            --bg-pane-light: #1f2937;
            --bg-pane-dark: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-tertiary: #9ca3af;
            --accent-primary: #3898ff;
            --accent-primary-dark: #007aff;
            --border-color: #374151;
            --shadow-color: rgba(0, 0, 0, 0.2);
            --brand-grad-from: #3898ff;
            --brand-grad-to: #3898ff;
            --hairline: color-mix(in srgb, var(--text-primary) 12%, transparent);
--glass-bg: color-mix(in srgb, var(--bg-main) 60%, transparent);
--glass-elevated: color-mix(in srgb, var(--bg-pane-dark) 60%, transparent);

        }

        .reputify-theme {
            --bg-main: #100F1B;
            --bg-pane-light: #181624;
            --bg-pane-dark: #211F30;
            --text-primary: #F0F0F0;
            --text-secondary: #A0A0B8;
            --text-tertiary: #6C6A7E;
            --accent-primary: #E6397F;
            --accent-primary-dark: #FF8A00;
            --border-color: #2A2837;
            --shadow-color: rgba(0, 0, 0, 0.2);
            --brand-grad-from: #E6397F;
            --brand-grad-to: #FF8A00;
            --hairline: color-mix(in srgb, var(--text-primary) 12%, transparent);
--glass-bg: color-mix(in srgb, var(--bg-main) 60%, transparent);
--glass-elevated: color-mix(in srgb, var(--bg-pane-dark) 60%, transparent);

        }
        /* --- START: Save Indicator Styles --- */
/* --- START: Save Indicator Styles --- */
#save-indicator {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: var(--accent-primary);
    transition: opacity 0.3s ease, transform 0.3s ease;

    /* Start hidden */
    opacity: 0;
    transform: scale(0) translateY(2px);
}
/* === Minimal glass buttons (icon pills) === */
.icon-btn {
  border-radius: 9999px;
  padding: 0.5rem;
  color: var(--text-secondary);
  transition: background-color .18s ease, color .18s ease, transform .12s ease;
  border: 0.5px solid var(--hairline);
  background-color: color-mix(in srgb, var(--bg-main) 65%, transparent);
}
.icon-btn:hover { color: var(--text-primary); background-color: var(--bg-pane-dark); }
.icon-btn:active { transform: translateY(0.5px); }

/* === Segmented control look for .view-btn === */
.view-btn {
  color: var(--text-secondary);
  border-radius: 9999px !important;
  border: 0;
  background: transparent;
  transition: background-color .16s ease, color .16s ease, box-shadow .16s ease, transform .12s ease;
}
.view-btn:hover { color: var(--text-primary); background: var(--bg-pane-dark); }
.view-btn.active,
.view-btn[data-active="true"] {
  background: color-mix(in srgb, var(--bg-main) 92%, transparent);
  color: var(--text-primary);
  box-shadow: 0 1px 0 rgba(255,255,255,0.06) inset, 0 6px 18px rgba(0,0,0,0.16);
}

/* === Interactive cards (list, gallery, kanban, recent) === */
.recent-note-card,
.kanban-card,
.list-note-item,
.gallery-note-card {
  transition: transform .18s ease, box-shadow .18s ease, background-color .18s ease, border-color .18s ease;
  will-change: transform;
}
.recent-note-card:hover,
.list-note-item:hover,
.gallery-note-card:hover,
.kanban-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 18px -6px var(--shadow-color), 0 6px 10px -6px var(--shadow-color);
}

/* === Ripple effect (attach via [data-ripple]) === */
[data-ripple] { position: relative; overflow: hidden; }
.ripple {
  position: absolute; border-radius: 9999px; transform: scale(0);
  animation: ripple .6s linear; pointer-events: none;
  background-color: currentColor; opacity: .16;
}
@keyframes ripple { to { transform: scale(24); opacity: 0; }}

/* === Subtle tilt (attach via .tilt) === */
.tilt { transform-style: preserve-3d; }
.tilt:hover { transform: perspective(1000px) rotateX(var(--tilt-x,0deg)) rotateY(var(--tilt-y,0deg)); }

/* Make the header pill toolbar feel elevated */
.editor-toolbar {
  box-shadow: 0 2px 10px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.06);
  background-color: color-mix(in srgb, var(--bg-pane-dark) 85%, transparent);
  border: 0.5px solid var(--hairline);
  border-radius: 12px;
}

/* --- START: New Backlinks Section Styles --- */
.backlink-item {
    display: block;
    background-color: var(--bg-pane-dark);
    border-radius: 0.5rem; /* 8px */
    padding: 0.75rem 1rem; /* 12px 16px */
    text-decoration: none;
    transition: background-color 0.2s ease-in-out;
}
.backlink-item:hover {
    background-color: var(--bg-pane-light);
}

.backlink-item-header {
    display: flex;
    align-items: center;
    gap: 0.5rem; /* 8px */
    font-size: 1rem; /* 16px */
}

.backlink-item-header .note-name {
    font-weight: 600; /* bold */
    color: var(--text-primary);
}

.backlink-item-header .folder-name {
    color: var(--text-secondary);
}
/* --- START: Slick Login Page Effects --- */
.auth-box {
    position: relative; /* Required for the pseudo-element to be positioned correctly */
    padding: 2px; /* This creates the space for the "border" glow */
    border-radius: 0.85rem; /* Slightly larger than the inner box's radius */
    overflow: hidden; /* This is crucial for the effect to work */
    z-index: 1;
}
/* ADD THIS BLOCK FOR HEADING HIERARCHY */
/* ADD THIS BLOCK TO HIDE THE PILL ON MOBILE */
@media (max-width: 767px) {
    #heading-nav-pill {
        display: none !important;
    }
}

.heading-tooltip-item.heading-tooltip-h1 { font-weight: 600; } /* Make H1 text bolder */
.heading-tooltip-item.heading-tooltip-h2 { padding-left: 1.25rem; } /* 20px */
.heading-tooltip-item.heading-tooltip-h3 { padding-left: 2rem; font-size: 0.8rem; } /* 32px */

/* New class for hover highlighting */
.heading-tooltip-item.hover-active {
    background-color: var(--bg-main);
    color: var(--text-primary);
}
/* This is the animated, rotating gradient that creates the glow */
.auth-box::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 200%; /* Larger than the container to ensure the gradient covers the edges */
    height: 300%;
    z-index: -1;
    background: conic-gradient(
        transparent,
        transparent,
        var(--accent-primary-dark), /* Your brand's orange */
        var(--accent-primary),     /* Your brand's pink */
        transparent,
        transparent
    );
    animation: rotate-glow 4s linear infinite;
}

@keyframes rotate-glow {
    from {
        transform: translate(-50%, -50%) rotate(0deg);
    }
    to {
        transform: translate(-50%, -50%) rotate(360deg);
    }
}

/* This is the actual box that holds the login content */
.auth-box-content {
    background-color: var(--bg-pane-light); /* Matches your original box color */
    border-radius: 0.75rem; /* The inner radius */
    width: 100%;
    height: 100%;
}
/* ADD THIS to your main &lt;style&gt; block */
.agent-remap-select {
    background-color: var(--bg-main);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    padding: 6px 10px;
    color: var(--text-primary);
}
.agent-remap-select:focus {
    outline: none;
    border-color: var(--accent-primary);
}
/* This adds a smooth transition to the button */
.brand-button {
    transition: opacity 0.2s, transform 0.2s, box-shadow 0.2s;
}
/* --- START: Heading Navigation Pill --- */
#heading-nav-pill.hidden {
    display: none;
}
/* --- START: Table Delete Button Style --- */
.delete-table-btn {
    padding: 0.25rem; /* 4px */
    border-radius: 0.25rem; /* 4px */
    background: none;
    border: none;
    color: var(--text-tertiary);
    cursor: pointer;
    flex-shrink: 0; /* Prevents the button from shrinking */
    transition: all 0.2s ease;
}
.delete-table-btn:hover {
    background-color: var(--bg-pane-dark);
    color: #ef4444; /* red-500 */
}
/* --- END: Table Delete Button Style --- */
.heading-nav-dot {
    width: 8px;
    height: 8px;
    border-radius: 9999px;
    background-color: var(--text-tertiary);
    cursor: pointer;
    transition: all 0.2s ease-in-out;
}

.heading-nav-dot:hover {
    background-color: var(--text-primary);
    transform: scale(1.25);
}

.heading-nav-dot.active {
    background-color: var(--accent-primary);
    transform: scale(1.5);
}

.heading-tooltip-item {
    display: block;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.875rem; /* 14px */
    color: var(--text-secondary);
    white-space: nowrap;
    cursor: pointer;
    transition: background-color 0.2s, color 0.2s;
}

.heading-tooltip-item:hover {
    background-color: var(--bg-main);
    color: var(--text-primary);
}

.heading-tooltip-item.active {
    color: var(--accent-primary);
    font-weight: 600;
}
/* --- END: Heading Navigation Pill --- */
/* This makes the button glow and grow slightly on hover */
.brand-button:hover {
    transform: scale(1.02);
    box-shadow: 0 0 25px rgba(230, 57, 127, 0.5);
}
/* --- END: Slick Login Page Effects --- */

.backlink-item-excerpt {
    font-size: 0.875rem; /* 14px */
    color: var(--text-secondary);
    margin-top: 0.5rem; /* 8px */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
/* --- START: Slick AI Agent Forge Modal Styles --- */
/* --- START: Slick AI Agent Forge Modal Styles --- */
#agent-forge-modal {
    /* Force fullscreen on all screen sizes */
    width: 100vw;
    height: 100vh;
    max-width: 100vw;
    max-height: 100vh;
    top: 0;
    left: 0;
    transform: none;
    border-radius: 2;
    border: none;
    padding: 0; /* Remove padding from the modal itself */
}


/* New style for the main content area to enable the two-pane layout */
#agent-forge-main-content {
    /* This allows the left and right panes to grow and fill the space */
    min-height: 0; 
}

/* --- START: Upgraded Agent Forge Live Log Styles --- */

/* Main log container */
#agent-forge-logs {
    font-family: 'Inter', sans-serif; /* Use the consistent Inter font */
    color: var(--text-secondary);
    font-size: 0.875rem; /* 14px */
    padding: 0.25rem;
}

/* Individual log entry styling */
#agent-forge-logs &gt; div {
    display: flex;
    align-items: flex-start; /* Aligns icon with the first line of text */
    gap: 0.75rem; /* 12px space between icon and text */
    padding: 0.5rem 0.75rem; /* 8px top/bottom, 12px left/right */
    border-radius: 6px;
    margin-bottom: 2px;
    line-height: 1.6;
    transition: background-color 0.3s;
    /* Animation for new log entries */
    animation: fadeInGlow 0.8s ease-out;
}

/* A subtle hover effect */
#agent-forge-logs &gt; div:hover {
    background-color: rgba(255, 255, 255, 0.03);
}

/* The glowing animation for new log entries */
@keyframes fadeInGlow {
    from {
        opacity: 0;
        background-color: rgba(230, 57, 127, 0.1); /* --accent-primary with opacity */
    }
    to {
        opacity: 1;
        background-color: transparent;
    }
}

/* Default icon for log entries */
#agent-forge-logs &gt; div::before {
    content: '';
    display: inline-block;
    flex-shrink: 0;
    width: 16px;
    height: 16px;
    margin-top: 3px; /* Fine-tune vertical alignment */
    background-color: currentColor;
    -webkit-mask-size: cover;
    mask-size: cover;
}

/* --- Styling for different log types based on text content --- */

/* Style for "[Step X]" lines */
#agent-forge-logs &gt; div:has(&gt; span.log-step) {
    color: var(--text-secondary);
}
#agent-forge-logs &gt; div:has(&gt; span.log-step)::before {
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-arrow-right-circle'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cpolyline points='12 16 16 12 12 8'%3E%3C/polyline%3E%3Cline x1='8' y1='12' x2='16' y2='12'%3E%3C/line%3E%3C/svg%3E");
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-arrow-right-circle'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cpolyline points='12 16 16 12 12 8'%3E%3C/polyline%3E%3Cline x1='8' y1='12' x2='16' y2='12'%3E%3C/line%3E%3C/svg%3E");
}

/* Style for "Success!" lines */
#agent-forge-logs &gt; div:has(&gt; span.log-success) {
    color: #4ade80; /* A nice green color */
}
#agent-forge-logs &gt; div:has(&gt; span.log-success)::before {
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-check-circle'%3E%3Cpath d='M22 11.08V12a10 10 0 1 1-5.93-9.14'%3E%3C/path%3E%3Cpolyline points='22 4 12 14.01 9 11.01'%3E%3C/polyline%3E%3C/svg%3E");
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-check-circle'%3E%3Cpath d='M22 11.08V12a10 10 0 1 1-5.93-9.14'%3E%3C/path%3E%3Cpolyline points='22 4 12 14.01 9 11.01'%3E%3C/polyline%3E%3C/svg%3E");
}

/* Style for "Resolved placeholder" lines */
#agent-forge-logs &gt; div:has(&gt; span.log-resolved) {
    color: var(--text-tertiary);
    font-size: 0.8rem; /* Make placeholder logs a bit smaller */
}
#agent-forge-logs &gt; div:has(&gt; span.log-resolved)::before {
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-database'%3E%3Cellipse cx='12' cy='5' rx='9' ry='3'%3E%3C/ellipse%3E%3Cpath d='M21 12c0 1.66-4 3-9 3s-9-1.34-9-3'%3E%3C/path%3E%3Cpath d='M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5'%3E%3C/path%3E%3C/svg%3E");
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-database'%3E%3Cellipse cx='12' cy='5' rx='9' ry='3'%3E%3C/ellipse%3E%3Cpath d='M21 12c0 1.66-4 3-9 3s-9-1.34-9-3'%3E%3C/path%3E%3Cpath d='M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5'%3E%3C/path%3E%3C/svg%3E");
}

/* Style for "[ERROR]" lines */
#agent-forge-logs &gt; div:has(&gt; span.log-error) {
    color: #ef4444; /* red-500 */
    background-color: rgba(239, 68, 68, 0.05); /* Subtle red background */
}
#agent-forge-logs &gt; div:has(&gt; span.log-error)::before {
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-alert-triangle'%3E%3Cpath d='M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z'%3E%3C/path%3E%3Cline x1='12' y1='9' x2='12' y2='13'%3E%3C/line%3E%3Cline x1='12' y1='17' x2='12.01' y2='17'%3E%3C/line%3E%3C/svg%3E");
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-alert-triangle'%3E%3Cpath d='M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z'%3E%3C/path%3E%3Cline x1='12' y1='9' x2='12' y2='13'%3E%3C/line%3E%3Cline x1='12' y1='17' x2='12.01' y2='17'%3E%3C/line%3E%3C/svg%3E");
}

/* --- END: Upgraded Agent Forge Live Log Styles --- */
/* --- START: NEW AI Agent Step Builder Styles --- */
.agent-step-card {
    background-color: var(--bg-pane-light);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    padding: 0.75rem;
    cursor: grab;
}
.agent-step-card:active {
    cursor: grabbing;
}
.agent-step-card.dragging {
    opacity: 0.5;
    background-color: var(--bg-pane-dark);
}
.agent-step-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.agent-step-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
}

.agent-step-title .step-number {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    background-color: var(--bg-main);
    border: 1px solid var(--border-color);
    border-radius: 999px;
    width: 20px;
    height: 20px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}
.agent-step-param {
    margin-top: 0.75rem;
    padding-left: 1.75rem; /* Aligns with title text */
}
.agent-step-param label {
    display: block;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-secondary);
    margin-bottom: 0.25rem;
}
.agent-step-param .param-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
}
.agent-step-param input, .agent-step-param select {
    width: 100%;
    background-color: var(--bg-main);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    padding: 6px 10px;
    font-size: 0.9em;
    color: var(--text-primary);
    transition: border-color 0.2s;
}
.agent-step-param input:focus, .agent-step-param select:focus {
    outline: none;
    border-color: var(--accent-primary);
}
.param-output-btn {
    position: absolute;
    right: 8px;
    color: var(--text-tertiary);
    cursor: pointer;
}
.param-output-btn:hover {
    color: var(--accent-primary);
}
.param-output-menu {
    position: absolute;
    background-color: var(--bg-pane-light);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 10;
    width: max-content;
    max-height: 150px;
    overflow-y: auto;
}
.param-output-item {
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
}
.param-output-item:hover {
    background-color: var(--bg-pane-dark);
}
.param-help-text {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    margin-top: 0.25rem;
}
/* FIX for invisible dropdown options */
.agent-action-select option {
    background-color: var(--bg-pane-light);
    color: var(--text-primary);
}
/* --- END: NEW AI Agent Step Builder Styles --- */
/* --- START: Agent Forge Tab Styles --- */
.forge-tab-content {
    display: none; /* Hide all tab content by default */
}
.forge-tab-content.active {
    display: block; /* Show only the active tab content */
}
.forge-tab-btn.active {
    border-color: var(--accent-primary);
    color: var(--text-primary);
}
/* --- END: Agent Forge Tab Styles --- */
#agent-forge-logs .text-red-500 {
    color: #ef4444; /* red-500 */
    background-color: rgba(239, 68, 68, 0.1);
}

#agent-context-pills .bg-bg-pane-dark {
    background-color: var(--bg-pane-dark);
    border: 1px solid var(--border-color);
    padding: 4px 10px;
}
/* --- END: Slick AI Agent Forge Modal Styles --- */
.backlink-item-footer {
    font-size: 0.75rem; /* 12px */
    color: var(--text-tertiary);
    margin-top: 0.75rem; /* 12px */
}
/* --- END: New Backlinks Section Styles --- */
#save-indicator.visible {
    /* Become visible and move down slightly for perfect centering */
    opacity: 1;
    transform: scale(1) translateY(1px);
    cursor: pointer; /* ADD THIS LINE */
}
/* --- END: Save Indicator Styles --- */
/* --- START: Save Indicator Alignment Fix --- */
#current-view-title {
    /* This removes any default browser margins that can interfere with centering */
    margin-bottom: 0; 
}
/* --- END: Save Indicator Alignment Fix --- */
/* --- END: Save Indicator Styles --- */
        .reputify-theme .prose {
    color: var(--text-secondary); /* Use the softer, off-white for body text */
}
#version-content-viewer.prose {
    color: var(--text-primary);
}
/* --- START: Final Agent Forge Polish --- */
.gradient-text {
    background-image: linear-gradient(to right, var(--brand-grad-from), var(--brand-grad-to));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}

#agent-forge-modal.glow-border {
    position: relative;
    overflow: visible; /* Needed for the glow to appear outside */
}

#agent-forge-modal.glow-border::before {
    content: '';
    position: absolute;
    inset: -1px; /* Sits just outside the modal's border */
    border-radius: 0.8rem; /* Should match the modal's border-radius */
    z-index: -1; /* Sits behind the modal content */
    background: linear-gradient(120deg, var(--accent-primary-dark), var(--accent-primary), var(--accent-primary-dark));
    background-size: 200% 200%;
    filter: blur(10px);
    opacity: 0.8;
    animation: glow-animation 5s linear infinite;
}

@keyframes glow-animation {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* Style for the new placeholder */
/* Style for the new placeholder */
/* Style for the new placeholder (Corrected for Centering) */
#agent-forge-logs .forge-placeholder {
    font-family: 'Inter', sans-serif;
    color: var(--text-tertiary);
    height: 100%;
    width: 100%;
    display: flex;
    /* These properties will now correctly override the conflicting styles */
    align-items: center;
    justify-content: center;
    font-style: italic;
    font-size: 1rem;
    padding: 0; /* Override padding from log entries */
    gap: 0;     /* Override gap from log entries */
}

/* This rule removes the unwanted square icon */
#agent-forge-logs .forge-placeholder::before {
    content: none;
}
/* --- START: Final Agent Forge Polish --- */
.gradient-text {
    background-image: linear-gradient(to right, var(--brand-grad-from), var(--brand-grad-to));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}

#agent-forge-modal.glow-border {
    position: relative;
    overflow: visible; /* Needed for the glow to appear outside */
}

#agent-forge-modal.glow-border::before {
    content: '';
    position: absolute;
    inset: -1px; /* Sits just outside the modal's border */
    border-radius: 0.8rem; /* Should match the modal's border-radius */
    z-index: -1; /* Sits behind the modal content */
    background: linear-gradient(120deg, var(--accent-primary-dark), var(--accent-primary), var(--accent-primary-dark));
    background-size: 200% 200%;
    filter: blur(10px);
    opacity: 0.8;
    animation: glow-animation 5s linear infinite;
}

@keyframes glow-animation {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* Style for the new placeholder */
/* Style for the new placeholder */
/* Style for the new placeholder (Corrected for Centering) */
#agent-forge-logs .forge-placeholder {
    font-family: 'Inter', sans-serif;
    color: var(--text-tertiary);
    height: 100%;
    width: 100%;
    display: flex;
    /* These properties will now correctly override the conflicting styles */
    align-items: center;
    justify-content: center;
    font-style: italic;
    font-size: 1rem;
    padding: 0; /* Override padding from log entries */
    gap: 0;     /* Override gap from log entries */
}

/* This rule removes the unwanted square icon */
#agent-forge-logs .forge-placeholder::before {
    content: none;
}
/* --- END: Final Agent Forge Polish --- */
/* --- END: Final Agent Forge Polish --- */
.help-command-row {
    display: grid;
    grid-template-columns: 160px 1fr;
    align-items: center; /* This is the only change */
    gap: 1rem;
}
.reputify-theme .prose {
    color: var(--text-primary); /* This changes the main text to white */
}
.in-note-highlight.current {
    background-color: var(--accent-primary-dark);
    color: var(--bg-main);
}
.reputify-theme .prose h1,
.reputify-theme .prose h2,
.reputify-theme .prose h3,
.reputify-theme .prose strong {
    color: var(--text-primary);
}
.reputify-theme .prose a {
    color: var(--accent-primary);
}
.reputify-theme .prose code {
    color: var(--accent-primary-dark);
}
.reputify-theme .prose blockquote {
    color: var(--text-tertiary);
    border-color: var(--border-color);
}
/* --- START: Notion-Style Mobile Menu CSS --- */
/* --- START: New 'Add Note' Button Styles --- */
/* --- START: New 'Add Note' Button Styles --- */
/* --- START: New 'Add Note' Button Styles --- */
.add-note-btn {
    /* This is now simpler because the flex layout handles positioning */
    padding: 0.25rem; /* 4px */
    border-radius: 0.25rem; /* 4px */
    color: var(--text-tertiary);
    transition: color 150ms ease-in-out, background-color 150ms ease-in-out;
    flex-shrink: 0; /* Prevents the button from being squished */
}

.add-note-btn:hover {
    color: var(--text-primary);
    background-color: var(--bg-pane-dark);
}
/* --- END: New 'Add Note' Button Styles --- */
/* --- END: New 'Add Note' Button Styles --- */
/* --- END: New 'Add Note' Button Styles --- */
/* Add these new rules for folder-specific view buttons */
/* Add this new rule for the slide-in secondary view */
/* Indicator for selected text color */
.toolbar-color-btn.active .color-swatch-indicator {
    box-shadow: 0 0 0 2px var(--accent-primary), 0 0 0 4px var(--bg-main);
}
.toolbar-color-btn.active:hover .color-swatch-indicator {
    box-shadow: 0 0 0 2px var(--accent-primary-dark), 0 0 0 4px var(--bg-main);
}
/* --- START: Calculator Modal Styles --- */
#calculator-modal {
    min-width: 260px;
    min-height: 380px;
}
.calc-btn {
    @apply h-14 rounded-md text-xl font-medium transition-colors duration-150;
    background-color: var(--bg-pane-light);
    color: var(--text-primary);
}
.calc-btn:hover {
    background-color: var(--bg-main);
}
.calc-btn:active {
    transform: scale(0.95);
}
.calc-btn.operator-btn {
    background-color: var(--bg-pane-dark);
    color: var(--accent-primary);
}
.calc-btn.operator-btn:hover {
    background-color: var(--border-color);
}
.calc-btn.equals-btn {
    background-image: linear-gradient(to right, var(--brand-grad-from), var(--brand-grad-to));
    color: white;
}
.calc-btn.equals-btn:hover {
    opacity: 0.9;
}
/* --- END: Calculator Modal Styles --- */
.folder-view-switcher {
    display: flex;
    gap: 0.5rem;
    padding: 0.25rem 0.5rem 0.5rem 2.75rem; /* Aligns with note items */
}
/* --- START: Fullscreen Modal Styles --- */
        #chatbot-modal, #chatbot-context-modal {
            /* On mobile, they will be fullscreen */
            width: 100vw;
            height: 100vh;
            max-width: 100vw;
            max-height: 100vh;
            top: 0;
            left: 0;
            transform: none;
            border-radius: 0;
        }

        /* On desktop, they will be large but not edge-to-edge */
        @media (min-width: 768px) {
            #chatbot-modal, #chatbot-context-modal {
                width: 90vw;
                height: 85vh;
                max-width: 1200px; /* Increased max width for chatbot */
                border-radius: 0.75rem; /* 12px */
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                border: 1px solid var(--border-color);
            }
            #chatbot-context-modal {
                 max-width: 800px; /* Specific larger size for context modal */
            }
        }
        /* --- END: Fullscreen Modal Styles --- */
.folder-view-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.25rem 0.75rem;
    border-radius: 0.375rem; /* 6px */
    font-size: 0.875rem; /* 14px */
    background-color: var(--bg-pane-dark);
    color: var(--text-tertiary);
    transition: all 0.2s ease;
}
.folder-view-btn:hover {
    color: var(--text-primary);
}
.folder-view-btn.active {
    background-color: var(--bg-main);
    color: var(--text-primary);
    font-weight: 500;
}
/* This is the main container for the slide-in menu */
#notion-style-mobile-menu.open {
    transform: translateX(0);
}

/* Section headers like "Jump back in" and "Private" */
.notion-menu-section-header {
    font-size: 0.75rem; /* 12px */
    font-weight: 600;
    color: var(--text-tertiary);
    text-transform: uppercase;
    padding: 1rem 0.5rem 0.5rem;
}
/* --- START: REFINED List View Checklist Preview Styles --- */
.list-view-all-checklists-container {
    padding: 0.75rem 1rem; /* The main container for all checklists in a note */
    border-top: 1px solid var(--border-color);
}
.checklist-preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem; /* 6px */
    background-color: var(--bg-pane-dark);
    color: var(--text-secondary);
    transition: all 0.2s;
}
.checklist-preview-header:hover {
    background-color: var(--bg-main);
    color: var(--text-primary);
}
.checklist-preview-header .feather-chevron-down {
    transition: transform 0.2s ease-in-out;
}
.checklist-preview-body {
    padding: 0.75rem 0.5rem 0.25rem;
    overflow: hidden; /* No scrollbar */
}
.checklist-preview-body ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}
.checklist-preview-item {
    font-size: 0.875rem; /* 14px */
    color: var(--text-secondary);
}
.checklist-preview-item.checked span {
    text-decoration: line-through;
    color: var(--text-tertiary);
}
.checklist-preview-item input[type="checkbox"] {
    width: 1rem; /* 16px */
    height: 1rem; /* 16px */
    accent-color: var(--accent-primary);
    flex-shrink: 0;
    cursor: pointer; /* Makes it feel interactive */
}
/* --- END: REFINED List View Checklist Preview Styles --- */
/* Grid layout for the "Jump back in" cards */
.jump-back-in-grid {
    display: flex;
    flex-wrap: nowrap; /* Prevent wrapping */
    gap: 0.5rem;
    overflow-x: auto; /* Enable horizontal scrolling */
    padding-bottom: 0.5rem; /* Add space for the scrollbar */
    /* Hide scrollbar for a cleaner look */
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
}
.jump-back-in-grid::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
}
.recent-note-card {
    width: 140px; /* Give cards a fixed width */
    flex-shrink: 0; /* Prevent cards from shrinking */
}

/* Individual card for a recent note */
.recent-note-card {
  background-color: var(--bg-pane-dark);
  border-radius: 0.5rem;
  padding: 0.75rem;
  height: 90px;
  display: flex; flex-direction: column; justify-content: space-between;
  font-weight: 500; font-size: 0.875rem;
  color: var(--text-secondary);
  border: 1px solid var(--border-color);
  overflow: hidden; text-decoration: none;
  transition: transform .18s ease, box-shadow .18s ease, background-color .18s ease;
  will-change: transform;
}
.recent-note-card:hover { background-color: var(--bg-main); transform: translateY(-2px); box-shadow: 0 10px 18px -6px var(--shadow-color), 0 6px 10px -6px var(--shadow-color); }

.recent-note-card .note-name {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* Use the existing sidebar styles for the "Private" section for consistency */
#private-section .collection-item {
    font-size: 1rem; /* 16px */
    padding: 0.6rem 0.5rem;
}
#private-section .collection-item:hover {
    background-color: var(--bg-pane-dark);
}
#private-section .collection-item.bg-bg-pane-dark {
    background-color: var(--bg-main) !important;
}
/* --- END: Notion-Style Mobile Menu CSS --- */
/* --- START: Mobile Settings Popup CSS --- */
#mobile-settings-popup.open {
    transform: translateX(0);
}

.toggle-switch {
  width: 44px; height: 24px; padding: 2px;
  background-color: var(--bg-pane-dark);
  border-radius: 9999px;
  border: 0.5px solid var(--hairline);
  box-shadow: inset 0 0 0 0.5px rgba(255,255,255,0.15);
  transition: background-color 180ms ease, border-color 180ms ease;
  cursor: pointer; flex-shrink: 0;
}
.toggle-switch.active {
  background-color: color-mix(in srgb, var(--accent-primary) 85%, var(--bg-main) 15%);
}
.toggle-knob {
  width: 20px; height: 20px; background-color: #fff; border-radius: 9999px;
  box-shadow: 0 1px 1px rgba(0,0,0,0.25), 0 0 0 0.5px rgba(0,0,0,0.08),
              inset 0 -1px 0 rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.8);
  transition: transform 180ms cubic-bezier(.2,.8,.2,1);
}
.toggle-switch.active .toggle-knob { transform: translateX(20px); }
.toggle-switch:active .toggle-knob { transform: translateX(var(--tw-translate-x, 0)) scale(0.96); }

/* --- END: Mobile Settings Popup CSS --- */
#mobile-tags-popup.open {
    transform: translateX(0);
}
/* Add these styles for checklist items */
/* Add these styles for checklist items */
/* UPDATED: Styles for checklist items in editor AND public view */
/* --- START: Simplified Checklist Styles --- */
/* --- START: Enhanced Checklist Styles --- */
/* --- START: Final Checklist Alignment Fix --- */
/* --- START: Final Checklist Alignment Fix --- */
/* --- START: New Checklist Container Styles --- */
.checklist-container {
    background-color: var(--bg-pane-dark);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    margin: 1em 0;
    padding: 0.75rem 1rem;
    user-select: none; /* Prevent text selection in view mode */
}
/* Corrects icon colors in menus for dark mode */
.prop-type-option svg, #properties-menu svg {
    stroke: currentColor;
}
/* ADD THIS RULE FOR PROPERTY MENU ICONS */
#properties-menu i {
    color: var(--text-secondary);
}
/* ADD THIS ENTIRE BLOCK FOR THE NEW CALENDAR FEATURES */

/* END OF NEW CALENDAR CSS */
/* ADD THIS CSS FOR THE NEW PROPERTY MODAL */
.prop-type-option {
    display: flex;
    align-items: center;
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--border-color);
    background-color: var(--bg-pane-dark);
    border-radius: 0.375rem;
    cursor: pointer;
    transition: all 0.2s ease;
}
.prop-type-option:hover {
    background-color: var(--bg-main);
}
.prop-type-option input[type="radio"] {
    margin-right: 0.75rem;
}
.prop-type-option input[type="radio"]:checked + span {
    color: var(--accent-primary);
    font-weight: 600;
}
.prop-type-option span {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.checklist-header {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 0.25rem;
    /* The margin makes the header span the full width of the parent */
    margin: -0.75rem -1rem 0.75rem -1rem;
    padding: 0.5rem 1rem; /* This is the only line that changed */
    border-bottom: 1px solid var(--border-color);
    /* Make the top corners rounded */
    border-radius: 0.5rem 0.5rem 0 0;
    /* Use a subtle, transparent black for a clean look */
    background-color: rgba(0, 0, 0, 0.1); 
}

.checklist-header-btn {
    padding: 0.25rem;
    border-radius: 0.25rem;
    color: var(--text-tertiary);
    background: none;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
}
.checklist-header-btn:hover {
    background-color: var(--bg-pane-light);
    color: var(--text-primary);
}
.checklist-header-btn.delete:hover {
    color: #ef4444; /* red-500 */
}

.checklist-body {
    padding-left: 0;
    margin: 0;
    list-style: none;
}

.checklist-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.25rem 0;
    cursor: pointer;
}

.checklist-item-checkbox {
    width: 1.25rem;
    height: 1.25rem;
    flex-shrink: 0;
}

.checklist-item-text {
    flex-grow: 1;
    color: var(--text-secondary);
    transition: color 0.2s;
}

.checklist-item.checked .checklist-item-text {
    text-decoration: line-through;
    color: var(--text-tertiary);
}

/* Styles for the Edit Modal */
.checklist-modal-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.checklist-modal-item input[type="text"] {
    flex-grow: 1;
    background-color: var(--bg-pane-dark);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    padding: 6px 10px;
    color: var(--text-primary);
    outline: none;
}
.checklist-modal-item input[type="text"]:focus {
    border-color: var(--accent-primary);
}
.checklist-modal-item-btn {
    padding: 0.25rem;
    color: var(--text-tertiary);
    cursor: pointer;
}
.checklist-modal-item-btn:hover {
    color: var(--text-primary);
}
/* --- END: New Checklist Container Styles --- */
.checklist-progress-container {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem; 
}

.checklist-progress-bar {
    flex-grow: 1;
    height: 8px;
    background-color: var(--bg-pane-light);
    border-radius: 9999px;
    overflow: hidden;
}

.checklist-progress-fill {
    height: 100%;
    background-color: var(--accent-primary);
    border-radius: 9999px;
    transition: width 0.3s ease-in-out;
}

.checklist-progress-text {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    flex-shrink: 0;
}
/* --- END: Final Checklist Alignment Fix --- */
/* --- START: Share Note Checklist Fix --- */
#public-note-content .task-list-item {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    margin: 0.5rem 0;
    list-style: none;
    padding-left: 0;
}

#public-note-content .task-list-item input[type="checkbox"] {
    flex-shrink: 0;
    width: 1.25rem;
    height: 1.25rem;
    
}

/* --- START: Final Interactive Table CSS --- */
/* --- START: Final Polished Table CSS --- */
#note-editor-body table {
    table-layout: fixed;
    width: 100%;
    border-spacing: 0; /* Ensures borders are clean */
}
#note-editor-body th.sortable-header {
    cursor: pointer;
    position: relative;
    padding-right: 20px;
    user-select: none;
}
#note-editor-body th .sort-indicator {
    position: absolute;
    right: 6px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1em;
    color: var(--accent-primary);
}
/* --- START: Modal Click Fix --- */
/* --- START: Modal Click Fix --- */
#modal-backdrop { display: none !important; }
/* --- END: Modal Click Fix --- */

/* --- END: Modal Click Fix --- */
#note-editor-body th.sortable-header:hover::after {
    content: '↕';
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-tertiary);
    font-weight: normal;
    opacity: 0.7;
}
#note-editor-body th.sortable-header[data-sort-dir="asc"]:hover::after,
#note-editor-body th.sortable-header[data-sort-dir="desc"]:hover::after {
    content: '';
}
/* --- NEW: Cell Focus Outline --- */
#note-editor-body td:focus,
#note-editor-body th:focus {
    outline: 2px solid var(--accent-primary) !important;
    outline-offset: -2px; /* Pulls outline inside the cell */
    z-index: 5;
    position: relative;
}
.column-resizer {
    position: absolute;
    top: 0;
    right: -3px;
    width: 6px;
    height: 100%;
    cursor: col-resize;
    z-index: 10;
}
/* --- NEW: Nicer Filter Bar --- */
.table-filter-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    padding: 4px 0;
}
.table-filter-wrapper .filter-icon {
    position: absolute;
    left: 12px; /* Slightly more space from the edge */
    top: 50%;
    transform: translateY(-50%);
    width: 1rem; /* 16px */
    height: 1rem; /* 16px */
    color: var(--text-tertiary);
    pointer-events: none;
    transition: color 0.2s ease; /* Adds a slick transition */
}
.table-filter-input:focus + .filter-icon,
.table-filter-wrapper:focus-within .filter-icon {
    color: var(--accent-primary);
}
.table-filter-input {
    width: 100%;
    background-color: var(--bg-pane-dark);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    padding: 6px 10px 6px 36px; /* Left padding for icon */
    font-size: 0.9em;
    color: var(--text-primary);
    transition: border-color 0.2s;
}
.table-filter-input:focus {
    outline: none;
    border-color: var(--accent-primary);
}
/* --- START: NEW CALENDAR &amp; DAY VIEW STYLES --- */
.calendar-grid-wrapper {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
}
.calendar-day-cell {
    position: relative;
    padding: 0.5rem;
    background-color: var(--bg-main);
    min-height: 120px;
    overflow-y: auto;
}
.calendar-day-cell.drag-over {
    background-color: rgba(230, 57, 127, 0.1);
    outline: 2px dashed var(--accent-primary);
    outline-offset: -2px;
}
.calendar-day-number {
    font-weight: 600;
    color: var(--text-secondary);
    cursor: pointer;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 9999px;
    transition: background-color 0.2s;
}
.calendar-day-number:hover {
    background-color: var(--bg-pane-dark);
}
.calendar-event-item {
    font-size: 0.875rem;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    background-color: var(--bg-pane-dark);
    cursor: grab;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.event-color-dot {
    width: 8px;
    height: 8px;
    border-radius: 9999px;
    flex-shrink: 0;
}
.day-view-container {
    flex-grow: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}
.day-view-all-day-section {
    padding: 0.5rem 0 0.5rem 5rem; /* Aligns with timeline */
    border-bottom: 1px solid var(--border-color);
    flex-shrink: 0;
}
.day-view-all-day-item {
    padding: 0.25rem 0.5rem;
    background-color: var(--bg-pane-dark);
    border-radius: 0.25rem;
    font-size: 0.875rem;
}
.day-view-timeline-wrapper {
    position: relative;
    flex-grow: 1;
}
.day-view-grid {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: grid;
    grid-template-rows: repeat(24, 48px);
}
.day-view-hour-slot {
    border-bottom: 1px solid var(--border-color);
    padding-left: 5rem; /* Space for time labels */
    position: relative;
}
.day-view-hour-slot::before {
    content: attr(data-time);
    position: absolute;
    left: 0;
    top: -0.5em;
    padding-right: 0.5rem;
    width: 5rem;
    text-align: right;
    font-size: 0.75rem;
    color: var(--text-tertiary);
}
.day-view-event-container {
    position: absolute;
    left: 5rem;
    right: 0.5rem;
    z-index: 10;
}
.day-view-event {
    padding: 0.75rem;
    background-color: var(--bg-pane-dark);
    border-radius: 0.375rem;
    border-left-width: 4px;
}
#now-indicator {
    position: absolute;
    height: 2px;
    background-color: #ef4444; /* red-500 */
    width: 100%;
    z-index: 20;
}
#now-indicator::before {
    content: '';
    position: absolute;
    left: -5px;
    top: -4px;
    width: 12px;
    height: 12px;
    background-color: #ef4444;
    border-radius: 9999px;
}
/* --- END: NEW CALENDAR &amp; DAY VIEW STYLES --- */
/* --- END: NEW CALENDAR &amp; DAY VIEW STYLES --- */
/* ADD THIS ENTIRE BLOCK TO DIFFERENTIATE LINKS */
/* Style for internal note links */
#note-editor-body a.internal-link::before {
    content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-file-text'%3E%3Cpath d='M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z'%3E%3C/path%3E%3Cpolyline points='14 2 14 8 20 8'%3E%3C/polyline%3E%3Cline x1='16' y1='13' x2='8' y2='13'%3E%3C/line%3E%3Cline x1='16' y1='17' x2='8' y2='17'%3E%3C/line%3E%3Cpolyline points='10 9 9 9 8 9'%3E%3C/polyline%3E%3C/svg%3E");
    display: inline-block;
    width: 14px;
    height: 14px;
    margin-right: 4px;
    vertical-align: -2px;
    opacity: 0.7;
}

/* Style for external website links */
#note-editor-body a[target="_blank"]:not(.download-btn)::after {
    content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round' class='feather feather-external-link'%3E%3Cpath d='M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6'%3E%3C/path%3E%3Cpolyline points='15 3 21 3 21 9'%3E%3C/polyline%3E%3Cline x1='10' y1='14' x2='21' y2='3'%3E%3C/line%3E%3C/svg%3E");
    display: inline-block;
    width: 14px;
    height: 14px;
    margin-left: 3px;
    vertical-align: -2px;
    opacity: 0.7;
}
/* END OF BLOCK TO ADD */
.table-filter-clear-btn {
    position: absolute;
    right: 10px;
    color: var(--text-tertiary);
    cursor: pointer;
    background: none;
    border: none;
    padding: 2px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
}
.table-filter-input:not(:placeholder-shown) + .table-filter-clear-btn {
    opacity: 1;
    pointer-events: auto;
}
/* --- End Filter Bar --- */
.table-menu-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem;
    border-radius: 4px;
    cursor: pointer;
    position: relative;
}
.table-menu-item:hover { background-color: var(--bg-pane-dark); }
.table-menu-item .submenu-arrow { margin-left: auto; }
.table-menu-item .submenu {
    display: none;
    position: absolute;
    left: 100%;
    top: -5px;
    background-color: var(--bg-pane-light);
    border-radius: 6px;
    padding: 0.25rem;
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    width: max-content;
}
.table-menu-item:hover &gt; .submenu { display: block; }
.color-swatch {
    width: 14px;
    height: 14px;
    border-radius: 3px;
    border: 1px solid var(--border-color);
}
.bg-highlight-yellow { background-color: rgba(250, 204, 21, 0.2); }
.bg-highlight-green { background-color: rgba(74, 222, 128, 0.2); }
.bg-highlight-blue { background-color: rgba(96, 165, 250, 0.2); }
.bg-highlight-red { background-color: rgba(248, 113, 113, 0.2); }
.text-color-red { color: #F87171; }
.text-color-orange { color: #FB923C; }
.text-color-green { color: #4ADE80; }
.text-color-blue { color: #007aff; }
#note-editor-body tfoot td {
    font-weight: bold;
    color: var(--text-secondary);
    background-color: var(--bg-pane-dark);
    padding: 8px;
    border-top: 2px solid var(--border-color);
}
/* --- END: Final Polished Table CSS --- */
/* --- END: New Interactive Table CSS --- */

/* --- START: Public Page Code Block Style Fix --- */
/* --- START: FINAL Public Page Code Block Style Fix --- */
#public-note-content .code-block-wrapper {
    background-color: #211F30; /* A dark background matching your reputify theme */
    border: 1px solid #2A2837;
    border-radius: 8px;
    overflow: hidden;
    margin: 1.5em 0;
}
#public-note-content .code-block-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: rgba(0,0,0,0.2);
    padding: 0.5rem 1rem;
    color: #A0A0B8;
    font-size: 0.8rem;
}
/* --- START: Table Filter Toggle CSS --- */

/* New wrapper to hold the filter and the toggle button */
.table-header-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem; /* 8px */
}

/* Makes the filter input container grow to fill available space */
.table-header-controls .table-filter-wrapper {
    flex-grow: 1;
}

/* Styles for the new collapse/expand button */
.toggle-filter-btn {
    padding: 0.25rem; /* 4px */
    border-radius: 0.25rem; /* 4px */
    background: none;
    border: none;
    color: var(--text-tertiary);
    cursor: pointer;
    flex-shrink: 0; /* Prevents the button from shrinking */
    transition: all 0.2s ease;
}

.toggle-filter-btn:hover {
    background-color: var(--bg-pane-dark);
    color: var(--text-primary);
}

/* The transition for the icon's rotation */
.toggle-filter-btn &gt; i {
    transition: transform 0.2s ease-in-out;
}

/* Hides the filter input when the table is collapsed */
table.filter-collapsed .table-filter-wrapper {
    display: none;
}

/* Rotates the chevron icon down when the table is collapsed */
table.filter-collapsed .toggle-filter-btn &gt; i {
    transform: rotate(180deg);
}

/* --- END: Table Filter Toggle CSS --- */
.exit-code-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    border-radius: 5px;
    transition: background-color 0.2s, color 0.2s;
}
.exit-code-btn:hover {
    background-color: var(--bg-pane-light);
    color: var(--accent-primary);
}
#public-note-content .code-block-wrapper pre {
    margin: 0 !important;
    padding: 1em !important;
}
/* This is the most important part: it makes the inner code block transparent */
#public-note-content .code-block-wrapper pre code.hljs {
    background: transparent !important;
    padding: 0 !important;
}
/* --- START: Checklist Interaction Fix --- */
/* Prevents direct text editing of checklist items in the main editor */
#note-editor-body .checklist-item-text {
    pointer-events: none;
    user-select: none;
    cursor: default; /* Reinforces non-interactive nature */
}
/* --- START: Checklist Modal Handle Style --- */
/* --- START: Checklist Modal Handle Style --- */
.checklist-modal-item .handle {
    display: inline-flex;
    touch-action: none;
    cursor: grab;
}

/* Style for the item being dragged */
.checklist-modal-item.dragging {
    opacity: 0.5;
    background-color: var(--bg-pane-dark);
}
/* --- END: Checklist Modal Handle Style --- */
/* --- START: Version History Modal Styles --- */
/* --- START: Version History Modal Styles --- */
#version-sidebar .version-item {
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;
    cursor: pointer;
    transition: all 0.2s;
    border: 1px solid var(--border-color);
    background-color: var(--bg-main);
    margin-bottom: 0.5rem;
}
#version-sidebar .version-item:hover {
    background-color: var(--bg-pane-light);
}
#version-sidebar .version-item.active {
    background-color: var(--bg-main);
    border-color: var(--accent-primary);
    font-weight: 600;
    box-shadow: 0 0 8px -2px var(--accent-primary);
}
.version-timestamp {
    color: var(--text-primary);
    font-size: 0.875rem;
}
.version-fulldate {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    font-weight: 400;
}
.version-message {
    font-size: 0.8rem;
    color: var(--text-primary);
    background-color: var(--bg-main);
    border: 1px solid var(--border-color);
    border-radius: 9999px;
    padding: 2px 8px;
    margin-top: 6px;
    display: inline-block;
}

/* Styles for the visual diff viewer */
#version-content-viewer ins {
    background-color: rgba(16, 185, 129, 0.2); /* Green for additions */
    text-decoration: none;
}
#version-content-viewer del {
    background-color: rgba(239, 68, 68, 0.2); /* Red for deletions */
}
/* --- END: Version History Modal Styles --- */
/* --- END: Version History Modal Styles --- */
/* --- END: Checklist Modal Handle Style --- */
/* --- END: Checklist Modal Handle Style --- */
/* --- END: Checklist Interaction Fix --- */
/* --- END: FINAL Public Page Code Block Style Fix --- */
/* --- END: Share Note Checklist Fix --- */
.version-group-header {
    font-size: 0.75rem; /* 12px */
    font-weight: 600;
    text-transform: uppercase;
    color: var(--text-tertiary);
    padding: 1rem 0.5rem 0.25rem;
    position: sticky;
    top: 0;
    background-color: var(--bg-pane-dark);
    z-index: 1;
}

.version-item .version-message {
    margin-top: 0.375rem; /* 6px */
    display: inline-block;
    max-width: 100%;
    white-space: normal;
    word-break: break-word;
    border-radius: 6px; /* Less rounded corners */
    line-height: 1.4;
}

        .brand-button {
    background-image: linear-gradient(to right, var(--brand-grad-from), var(--brand-grad-to));
    color: white;
    border: none;
    padding: 0.5rem 1rem; /* 8px top/bottom, 16px left/right */
    border-radius: 0.375rem; /* 6px rounded corners */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-weight: 500;
    transition: opacity 0.2s;
}

.brand-button:hover {
    opacity: 0.9;
}
.brand-button.confirm-state {
    background-image: none;
    background-color: #ef4444; /* red-500 */
}
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-main);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        #flashcard-container.flipped #flashcard {
    transform: rotateY(180deg);
}
.flashcard-face {
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
}
.transform-style-3d {
    transform-style: preserve-3d;
}
.perspective-1000 {
    perspective: 1000px;
}
.rotate-y-180 {
    transform: rotateY(180deg);
}
/* --- START: Modal Scroll Fix --- */
#global-ai-modal .modal-content-area {
    overflow-y: auto;
    max-height: 65vh; /* Sets a max height relative to the viewport */
}
#editor-footer {
    display: none;
}
/* Add this to make the header fade smoothly */
#main-header {
  position: sticky;
  top: 0;
  z-index: 50;
  -webkit-backdrop-filter: saturate(180%) blur(20px);
  backdrop-filter: saturate(180%) blur(20px);
  background-color: var(--glass-bg);
  border-bottom: 0.5px solid var(--hairline);
  transition: backdrop-filter 200ms ease, background-color 200ms ease, opacity 0.4s ease-in-out;
}

/* This class will be toggled by JavaScript to hide/show the header */
#main-header.header-hidden {
    opacity: 0;
    pointer-events: none; /* Prevents clicking on invisible buttons */
}
#main-header.header-focused {
    opacity: 0;
    pointer-events: none;
}
/* --- END: Modal Scroll Fix --- */
        
        /* --- UI Polish &amp; Animations --- */
#note-editor-body {
    overflow-wrap: break-word;
    word-wrap: break-word; 
    line-height: 1.65;
    letter-spacing: -0.015em;
    padding-bottom: 50vh; /* Adds scroll-past-the-end space */
}

#note-editor-body p, #public-note-content p {
    margin-top: 0.5em; /* Reduced from 0.75em for more subtle spacing */
}
#command-prompt-container {
  background-color: var(--glass-elevated);
  -webkit-backdrop-filter: saturate(180%) blur(18px);
  backdrop-filter: saturate(180%) blur(18px);
  border: 0.5px solid var(--hairline);
  border-radius: 14px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.18);
}


#command-prompt-container.hidden {
    opacity: 0;
    transform: translate(-50%, 20px) scale(0.95);
    pointer-events: none;
}

.command-suggestion-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem;
    border-radius: 0.25rem;
    cursor: pointer;
}
.command-suggestion-item:hover {
    background-color: var(--bg-pane-light);
}
.command-suggestion-item.active {
    background-color: var(--accent-primary);
    color: white;
}
.command-suggestion-item .cmd-name {
    font-weight: 600;
}
.command-suggestion-item .cmd-alias {
    font-size: 0.75rem;
    background-color: var(--bg-pane-light);
    color: var(--text-secondary);
    border-radius: 0.25rem;
    padding: 2px 6px;
}
.command-suggestion-item.active .cmd-alias {
    background-color: rgba(255, 255, 255, 0.2);
    color: white;
}
.command-suggestion-item .cmd-desc {
    font-size: 0.875rem;
    color: var(--text-secondary);
}
.command-suggestion-item.active .cmd-desc {
    color: rgba(255, 255, 255, 0.8);
}
#note-editor-title {
    overflow-wrap: break-word;
    word-wrap: break-word;
}
        #notes-list-pane {
            transition: width 300ms ease-in-out, transform 300ms ease-in-out;
            overflow: hidden;
        }
        #toggle-settings-btn.collapsed .feather-chevron-down {
    transform: rotate(-90deg);
}
#settings-list-container.collapsed {
    max-height: 0;
    opacity: 0;
    margin-top: 0;
    overflow: hidden;
}
/* Find and replace the old #command-suggestions CSS with this */

/* Find and replace the old #command-suggestions rule with this one */

/* Replace your existing #command-suggestions rule with this one */
#command-suggestions {
    /* We remove max-height here because JavaScript will now control it */
    overflow-y: auto;
    display: grid;
    grid-template-columns: 100%;
}

/* Add this new rule to style the content-match suggestions */
.command-suggestion-item.content-match {
    display: block; /* Overrides the default flex layout to allow stacking */
    padding: 0.5rem;
}

/* This is the new reusable class for all custom scrollbars */
/* Find and replace the old .custom-scrollbar CSS with this */

.custom-scrollbar {
    /* This makes the scrollbar float over content in compatible browsers (Chrome/Edge) */
    overflow-y: overlay;
    /* Fallback for other browsers like Firefox */
    overflow-y: auto;
    
    scrollbar-width: thin;
    scrollbar-color: var(--bg-pane-dark) transparent;
}

.custom-scrollbar::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

.custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
}

/* Make the scrollbar thumb transparent by default, effectively hiding it */
.custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: transparent;
    border-radius: 10px;
    border: 2px solid transparent;
}

/* ONLY show the scrollbar thumb when you hover over the scrollable container */
.custom-scrollbar:hover::-webkit-scrollbar-thumb {
    background-color: var(--bg-pane-dark);
    border-color: var(--bg-pane-light);
}

/* Hides the default scrollbar and styles a new one for Chrome/Safari/Edge */
#command-suggestions::-webkit-scrollbar {
    width: 8px;
}

#command-suggestions::-webkit-scrollbar-track {
    background: transparent;
}

#command-suggestions::-webkit-scrollbar-thumb {
    background-color: var(--bg-pane-dark);
    border-radius: 10px;
    border: 2px solid var(--bg-pane-light);
}
        #flashcard-front p,
#flashcard-back p {
    color: var(--text-primary) !important;
    margin: 0;
}
#main-content-area {
    min-height: 0;
}
#backlinks-pane {
    background-color: var(--bg-pane-light);
}
/* --- START: Scrollbar Hiding Utility --- */
.no-scrollbar::-webkit-scrollbar {
    display: none; /* For Chrome, Safari, and Opera */
}
.no-scrollbar {
    -ms-overflow-style: none;  /* For Internet Explorer and Edge */
    scrollbar-width: none;  /* For Firefox */
}
/* --- END: Scrollbar Hiding Utility --- */
.backlink-item {
    background-color: var(--bg-main);
    border: 1px solid var(--border-color);
    transition: box-shadow 0.2s;
}
.backlink-item:hover {
    box-shadow: 0 4px 12px var(--shadow-color);
}
#toggle-backlinks-btn.collapsed .feather-chevron-down {
    transform: rotate(-90deg);
}
#current-view-title {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
#backlinks-list.collapsed {
    max-height: 0;
    opacity: 0;
    margin-top: 0;
    overflow: hidden;
}
/* --- START: Selection-based Hide Checkboxes --- */
.task-list-item.checkbox-hidden input[type="checkbox"] {
    display: none;
}
/* --- END: Selection-based Hide Checkboxes --- */
/* Add these styles for the mobile toolbar fix */

        
        #notes-list-pane .sidebar-content-wrapper {
            transition: opacity 150ms ease-in-out;
        }
        #notes-list-pane {
    transition: min-width 300ms ease-in-out, transform 300ms ease-in-out; /* MODIFIED: Animate min-width instead of width */
    overflow: hidden;
}
#editor-pane {
    transition: margin-left 300ms ease-in-out; /* ADD THIS LINE */
}
#notes-list-pane.collapsed {
    min-width: 0px !important; /* MODIFIED: Use min-width */
    width: 0px !important;
    border-right-width: 0px;
}
body.sidebar-collapsed #editor-pane {
    margin-left: 0 !important; /* ADD THIS LINE */
}
        #notes-list-pane.collapsed .sidebar-content-wrapper {
            opacity: 0;
            pointer-events: none;
        }
        #tag-list-container.collapsed {
    max-height: 0;
    opacity: 0;
    margin-top: 0;
    overflow: hidden;
}
/* --- START: AI Response Copy Button Style --- */
.ai-response-copy-btn {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    padding: 0.35rem;
    border-radius: 0.375rem;
    background-color: var(--bg-pane-light);
    color: var(--text-tertiary);
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
    cursor: pointer;
    z-index: 10;
}
.relative:hover .ai-response-copy-btn {
    opacity: 1;
}
.ai-response-copy-btn:hover {
    color: var(--text-primary);
}
/* --- END: AI Response Copy Button Style --- */
/* Add these styles for tables in the editor */
/* UPDATED: Styles for tables in editor AND public view */
/* UPDATED: Styles for tables in editor AND public view */
/* --- START: Public Note Table Scroll Fix --- */
/* --- START: Public Note Table Scroll Fix --- */
#note-editor-body table,
#public-note-content table {
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch; /* For smoother scrolling on mobile */
}
#editor-pane {
    min-width: 0;
}
.card-content {
    word-break: break-all;
}
/* --- END: Public Note Table Scroll Fix --- */
/* --- END: Public Note Table Scroll Fix --- */
#note-editor-body table, #public-note-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 1em 0;
}
#note-editor-body th, #note-editor-body td,
#public-note-content th, #public-note-content td {
    border: 1px solid var(--border-color);
    padding: 0.625rem; /* Increased by 25% from 0.5rem */
    text-align: left;
}
#note-editor-body th, #public-note-content th {
    background-color: var(--bg-pane-dark);
    font-weight: 600;
    color: var(--text-primary); /* This is the fix for the text color */
}

#toggle-tags-btn.collapsed .feather-chevron-down {
    transform: rotate(-90deg);
}

        #sidebar-toggle-btn {
            transition: left 300ms ease-in-out, background-color 0.2s ease;
        }
        #flashcard-front, #flashcard-back {
    color: var(--text-primary);
    font-size: 1.25rem; /* Makes the text a bit bigger */
    line-height: 1.5;
}
        #sidebar-toggle-btn .feather-chevron-left {
            transition: transform 0.3s ease;
        }
        
        body.sidebar-collapsed #sidebar-toggle-btn .feather-chevron-left {
            transform: rotate(180deg);
        }

        .collection-item .chevron { transition: transform 0.15s ease; }
        .collection-item.open &gt; .chevron { transform: rotate(90deg); }
        .collection-item-wrapper.drop-target-folder { background-color: rgba(230, 57, 127, 0.1); border: 1px dashed var(--accent-primary); }
        .file-attachment-widget {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background-color: var(--bg-pane-dark);
    border: 1px solid var(--border-color);
    padding: 0.75rem;
    border-radius: 0.5rem;
    margin: 1em 0;
}
.file-attachment-widget .file-info {
    flex-grow: 1;
    min-width: 0;
}
.file-attachment-widget .file-name {
    font-weight: 600;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.file-attachment-widget .file-size {
    font-size: 0.75rem;
    color: var(--text-tertiary);
}
.file-attachment-widget .download-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background-color: var(--accent-primary);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    font-weight: 500;
    text-decoration: none;
    transition: opacity 0.2s;
}
.file-attachment-widget .download-btn:hover {
    opacity: 0.8;
}
.file-attachment-widget {
    position: relative; /* Needed for the delete button */
}
.attachment-delete-btn {
    position: absolute;
    top: 0.25rem; /* 4px */
    right: 0.25rem; /* 4px */
    padding: 0.125rem; /* 2px */
    border-radius: 9999px;
    background-color: var(--bg-pane-light);
    color: var(--text-tertiary);
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
    cursor: pointer;
}
.file-attachment-widget:hover .attachment-delete-btn {
    opacity: 1;
}
.attachment-delete-btn:hover {
    color: #ef4444; /* A standard red color */
}
        .kanban-card {
  background-color: var(--bg-main);
  height: 140px;
  display: flex; flex-direction: column; justify-content: space-between;
  border: 1px solid var(--border-color);
  border-radius: 0.5rem;
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
  will-change: transform;
}
.kanban-card:hover { transform: translateY(-2px); box-shadow: 0 10px 18px -6px var(--shadow-color), 0 6px 10px -6px var(--shadow-color); }
.kanban-card.dragging { opacity: .6; transform: rotate(3deg); }


        .kanban-card.pinned, .list-note-item.pinned {
            border-color: var(--accent-primary);
            box-shadow: 0 0 8px -2px var(--accent-primary);
        }
        .kanban-card.pinned { transform: scale(1.02); }
        .kanban-card.pinned:hover { transform: scale(1.02) translateY(-4px); }
        
        .drop-target-column { background-color: var(--bg-pane-dark) !important; opacity: 0.5; }
        .drop-indicator { height: 2px; background-color: var(--accent-primary); margin: 0; padding: 0; pointer-events: none; }
        
        .context-menu, .dropdown-menu { transition: opacity 100ms ease, transform 100ms ease; }
        
        #note-editor-body:empty:before {
            content: attr(data-placeholder);
            color: var(--text-tertiary);
            pointer-events: none;
            display: block;
        }
        #note-editor-body a, #markdown-preview a, #summary-content a, .chat-bubble a {
            color: var(--accent-primary);
            text-decoration: underline;
            cursor: pointer;
        }
        .internal-link-broken {
            color: #ef4444; /* red-500 */
            text-decoration: underline;
            text-decoration-style: dotted;
            cursor: help;
        }
        #note-editor-body ul:not(.checklist-body), #markdown-preview ul, #summary-content ul, .chat-bubble ul, .ai-summary ul { list-style: disc; padding-left: 2rem; margin-top: 0.5rem; margin-bottom: 0.5rem; }
        #note-editor-body ol, #markdown-preview ol, #summary-content ol, .chat-bubble ol, .ai-summary ol { list-style: decimal; padding-left: 2rem; margin-top: 0.5rem; margin-bottom: 0.5rem; }
        #note-editor-body h1, #note-editor-body h2, #note-editor-body h3,
#markdown-preview h1, #markdown-preview h2, #markdown-preview h3, 
#public-note-content h1, #public-note-content h2, #public-note-content h3 {
     font-weight: 700;
     line-height: 1.3;
     margin-top: 1.6em;      /* Increased space ABOVE headings */
     margin-bottom: 0.6em;   /* Increased space BELOW headings */
     padding-bottom: 0.3em;  /* Space between text and underline */
     border-bottom: 1px solid var(--border-color); /* The Notion-style underline */
}
        #note-editor-body h1 { font-size: 2.2rem; font-weight: 800; letter-spacing: -0.02em; margin: 1.2em 0 0.4em; }
#note-editor-body h2 { font-size: 1.7rem; font-weight: 700; letter-spacing: -0.01em; margin: 1.1em 0 0.35em; }
#note-editor-body h3 { font-size: 1.35rem; font-weight: 650; letter-spacing: -0.005em; margin: 1.0em 0 0.3em; }

        #note-editor-body img, #markdown-preview img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 0.5em 0;
            cursor: default;
        }
        #note-editor-body blockquote, #markdown-preview blockquote, #summary-content blockquote, .chat-bubble blockquote, .ai-summary blockquote {
            border-left: 4px solid var(--border-color);
            padding-left: 1em;
            margin-left: 0;
            color: var(--text-secondary);
        }
        
        /* Inline code and Monospace */
        #note-editor-body code, #markdown-preview code {
            background-color: var(--bg-pane-dark);
            padding: 2px 5px;
            border-radius: 4px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            font-size: 0.9em;
        }

        #note-editor-body pre code, #markdown-preview pre code {
            background-color: transparent;
            padding: 0;
            border-radius: 0;
            font-size: 1em;
        }
        
        #markdown-preview pre {
            background-color: var(--bg-pane-dark);
            padding: 1em;
            border-radius: 8px;
            overflow-x: auto;
        }
        #markdown-preview pre code.hljs {
            padding: 0;
            background-color: transparent;
        }
        
        /* Editor Code Block Styles */
        #note-editor-body .code-block-wrapper, #markdown-preview .code-block-wrapper, #public-note-content .code-block-wrapper {
            background-color: #211F30;
            border-radius: 8px;
            margin: 1.5em 0;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }
        html.light #note-editor-body .code-block-wrapper, html.dark #note-editor-body .code-block-wrapper {
             background-color: #1f2937; /* A consistent dark background */
        }
        .code-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(0,0,0,0.2);
            padding: 0.5rem 1rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
            text-transform: uppercase;
        }
        .copy-code-btn, .delete-block-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 5px;
            transition: background-color 0.2s, color 0.2s;
        }
        .copy-code-btn:hover, .delete-block-btn:hover {
            background-color: var(--bg-pane-light);
        }
        .copy-code-btn:hover { color: var(--text-primary); }
        .delete-block-btn:hover { color: #ef4444; }

        #note-editor-body .code-block-wrapper pre, #markdown-preview .code-block-wrapper pre, #public-note-content .code-block-wrapper pre {
            margin: 0 !important;
            padding: 1em !important;
            background-color: transparent !important;
            white-space: pre-wrap;
            /** change to pre if you want horizontal scroll but need fix **/
            word-wrap: break-word;
        }
        #note-editor-body .code-block-wrapper pre code, #markdown-preview .code-block-wrapper pre code, #public-note-content .code-block-wrapper pre code {
            padding: 0 !important;
            background-color: transparent !important;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;
            font-size: 1em !important;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        #search-results-view mark {
            background-color: var(--accent-primary-dark);
            border-radius: 3px;
            padding: 1px 2px;
            color: var(--bg-main);
        }
        
        .column-header:hover .delete-column-btn { opacity: 1; }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .summarize-btn {
    transition: opacity 0.2s ease-in-out;
}
        .list-note-item:hover .summarize-btn { opacity: 1; }

        .chat-bubble { max-width: 80%; }
        .chat-bubble.user { background-image: linear-gradient(to right, var(--brand-grad-from), var(--brand-grad-to)); color: white; }
        .chat-bubble.model { background-color: var(--bg-pane-dark); }
        .chat-bubble.thinking {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: .5; }
        }

        .truncate-multiline {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .kanban-card .card-content { -webkit-line-clamp: 3; }
        .list-note-item .card-content { -webkit-line-clamp: 2; }
        
        .view-btn {
  color: var(--text-secondary);
  border: 0.5px solid var(--hairline);
  background-color: color-mix(in srgb, var(--bg-main) 70%, transparent);
  border-radius: 10px;
  transition: background-color 160ms ease, color 160ms ease, box-shadow 160ms ease;
}
.view-btn.active {
  background-color: color-mix(in srgb, var(--bg-main) 95%, transparent);
  color: var(--text-primary);
  box-shadow: 0 1px 0 rgba(255,255,255,0.06) inset, 0 4px 12px rgba(0,0,0,0.12);
}

        .reputify-theme .view-btn.active {
             box-shadow: 0 1px 5px 0 rgba(0,0,0,0.2);
        }

        .settings-footer-item {
            @apply w-full text-left px-3 py-2 text-sm hover:bg-bg-pane-dark rounded flex items-center gap-3 text-text-secondary hover:text-text-primary;
        }
        
        #dictate-btn.recording {
            color: #ef4444; /* red-500 */
            animation: pulse-red 1.5s infinite;
        }
        @keyframes pulse-red {
          0%, 100% { opacity: 1; }
          50% { opacity: .6; }
        }
        
        #tag-list-container .tag-filter-item.active {
            background-color: var(--accent-primary);
            color: white;
            font-weight: 600;
        }
        /* --- START: Full Page Mobile Menu CSS --- */
#mobile-menu-fullscreen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: var(--bg-main);
    z-index: 100;
    display: flex;
    flex-direction: column;
    padding: 1rem;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.2s ease-out, transform 0.2s ease-out;
    pointer-events: none;
}

#mobile-menu-fullscreen.open {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
}

#mobile-menu-fullscreen-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem;
    flex-shrink: 0;
}

#mobile-menu-fullscreen-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
}

#mobile-menu-fullscreen-content {
    flex-grow: 1;
    overflow-y: auto;
    padding-top: 1rem;
}

/* Style for the individual menu items */
#mobile-menu-fullscreen-content button {
    display: flex;
    align-items: center;
    gap: 1rem;
    width: 100%;
    padding: 1rem;
    text-align: left;
    font-size: 1rem;
    border-radius: 0.5rem;
    color: var(--text-secondary);
    transition: background-color 0.2s, color 0.2s;
}

#mobile-menu-fullscreen-content button:hover {
    background-color: var(--bg-pane-dark);
    color: var(--text-primary);
}

#mobile-menu-fullscreen-content hr {
    border-color: var(--border-color);
    margin: 0.5rem 0;
}

#mobile-menu-fullscreen-content .text-red-500 {
    color: #ef4444; /* red-500 */
}
/* --- END: Full Page Mobile Menu CSS --- */
        /* --- START: Mobile Inline Toolbar Scroll --- */
        /* --- START: Mobile Header Spacing Fix --- */
body.mobile-editor-active #mobile-sticky-toolbar {
    top: 0 !important;
}
/* --- END: Mobile Header Spacing Fix --- */
@media (max-width: 767px) {
    #inline-toolbar {
        display: none !important; /* This completely hides the old toolbar on mobile */
        max-width: 200px; /* Limit the width on mobile */
    }
    #inline-toolbar-buttons {
        scroll-behavior: smooth;
    }
    .toolbar-scroll-btn {
        display: flex; /* Show the scroll buttons on mobile */
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }
}
/* --- END: Mobile Inline Toolbar Scroll --- */

        /* Mobile-specific overrides */
        @media (max-width: 767px) {
            #notes-list-pane {
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                z-index: 40; /* Higher z-index for mobile overlay */
                transform: translateX(-100%);
                width: 280px !important; /* Fixed width for mobile overlay */
                border-right-width: 1px;
            }
            #search-bar-container {
        padding-left: 0.75rem;  /* 12px */
        padding-right: 0.75rem; /* 12px */
    }

    /* Target the inner div that holds the icons and input */
    #search-bar-container &gt; div {
        padding-left: 1rem;     /* 16px padding for the search icon */
        padding-right: 0.5rem;  /* 8px padding for the 'X' icon */
    }

    /* Remove the negative margin on the close button that causes it to protrude */
    #search-bar-container #search-close-btn {
        margin-right: 0;
    }
            #highlight-controls {
        padding-right: 0.75rem; /* Pushes the 'X' icon inward */
    }

    /* START: In-Note Search Bar Mobile Fix */
    /* --- START: In-Note Search Bar Mobile Polish --- */
/* Controls the container to ensure centering and spacing from screen edges */
#highlight-controls {
    padding: 0.5rem 0.75rem; /* 8px top/bottom, 12px left/right for symmetry */
}

/* Main search bar styling */
#in-note-search-bar {
  height: 44px;
  gap: 0.25rem;
  padding-left: 0.75rem;
  padding-right: 0.25rem;
  background-color: var(--glass-elevated);
  -webkit-backdrop-filter: saturate(180%) blur(16px);
  backdrop-filter: saturate(180%) blur(16px);
  border: 0.5px solid var(--hairline);
  border-radius: 9999px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.18);
}


/* Target the text counter ("1 of 2") to make it narrower */
#in-note-search-bar #in-note-search-count {
    width: auto;        /* Let it size to its content */
    padding: 0 0.25rem; /* Add a little horizontal space */
}

/* Rely on flexbox 'items-center' for vertical alignment of input text */
#in-note-search-bar #in-note-search-input {
    padding-top: 0;
    padding-bottom: 0;
}
/* --- START: Sidebar Resizer Removal --- */
#pane-resizer {
    display: none !important;
}
/* --- END: Sidebar Resizer Removal --- */
/* --- END: In-Note Search Bar Mobile Polish --- */
            #main-header {
           @apply z-10; /* Ensures the header stays above the content area */
        }

        #notes-list-pane .sidebar-content-wrapper {
            transition: opacity 150ms ease-in-out;
        }
            #notes-list-pane.open {
                transform: translateX(0);
                box-shadow: 0 0 20px rgba(0,0,0,0.2);
            }
            #pane-resizer, #sidebar-toggle-btn { display: none; }
            #mobile-menu-button { display: block; }
            #desktop-new-note-btn { display: none; }
            #mobile-new-note-fab { display: flex; }
            #desktop-header-controls { display: none; }
            #mobile-header-controls { display: flex; }
            
        }

        #app-container {
    display: none; /* Hide the main app by default */
}
#auth-container { display: none; }

    </style><script src="preload.js"></script><script src="https://cdn.tailwindcss.com?plugins=typography"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet" />
    
    <script src="https://unpkg.com/feather-icons"></script>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css" />
    <link rel="manifest" href="manifest.json" />
    <script src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js" defer=""></script>
    <script src="https://cdn.jsdelivr.net/npm/lunr/lunr.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script> <!-- ADD THIS LINE -->
 
        <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.1/dist/browser-image-compression.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.1/dist/browser-image-compression.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
        

    <script src="https://cdnjs.cloudflare.com/ajax/libs/diff_match_patch/20121119/diff_match_patch.js"></script>
    

    

    
    
    
    
</head>
<body class="overflow-hidden">
<div id="auth-container" class="flex items-center justify-center h-screen bg-bg-main p-4">
    <div class="auth-box w-full max-w-md rounded-xl shadow-2xl">
        <div class="auth-box-content p-8 space-y-8">
            <div class="text-center">
                <a href="https://reputifly.com" target="_blank">
                    <img src="https://reputifly.com/wp-content/uploads/2025/05/cropped-reputifly-new-e1746390492876.png" alt="Reputifly Logo" class="w-32 mx-auto mb-4" />
                </a>
                <h2 id="auth-title" class="text-3xl font-bold text-text-primary">Welcome Back</h2>
                <p class="mt-2 text-text-secondary">Your AI-Powered Second Brain</p>
            </div>
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="login-email" class="text-sm font-medium text-text-secondary">Email address</label>
                    <input id="login-email" name="email" type="email" required="" autocomplete="email" class="w-full px-3 py-2 mt-1 bg-bg-pane-dark border border-border-color rounded-md focus:outline-none focus:ring-2 focus:ring-accent-primary transition-shadow duration-300 focus:shadow-lg focus:shadow-accent-primary/30" />
                </div>
                <div>
                    <label for="login-password" class="text-sm font-medium text-text-secondary">Password</label>
                    <input id="login-password" name="password" type="password" required="" autocomplete="current-password" class="w-full px-3 py-2 mt-1 bg-bg-pane-dark border border-border-color rounded-md focus:outline-none focus:ring-2 focus:ring-accent-primary transition-shadow duration-300 focus:shadow-lg focus:shadow-accent-primary/30" />
                </div>
                <p id="auth-error" class="text-sm text-red-500 h-5"></p>
                <button type="submit" class="w-full brand-button text-white font-semibold py-2.5 rounded-lg">Login</button>
            </form>
            <p class="text-sm text-center text-text-secondary">
                <span id="login-text-link">Don't have an account? <a href="#" id="show-signup" class="font-medium text-accent-primary hover:underline">Sign up</a></span>
                <span id="signup-text-link" class="hidden">Already have an account? <a href="#" id="show-login" class="font-medium text-accent-primary hover:underline">Login</a></span>
            </p>
        </div>
    </div>
</div>

    <div id="app-container" class="flex h-screen">

        <aside id="notes-list-pane" class="w-[280px] bg-bg-pane-light border-r border-border-color flex flex-col flex-shrink-0">
            <div class="sidebar-content-wrapper flex flex-col h-full min-w-[280px]">
                <header class="flex justify-between items-center p-4 border-b border-border-color flex-shrink-0 gap-2 h-[65px]">
                    <div class="flex items-center gap-3">
                        <div id="profile-section" class="relative">
                            <button id="profile-button" title="Account Settings" class="w-8 h-8 rounded-full bg-gradient-to-r from-[var(--brand-grad-from)] to-[var(--brand-grad-to)] flex items-center justify-center font-bold text-white hover:opacity-90 transition-opacity">
                                <div id="user-initial">R</div>
                            </button>
                            <div id="profile-dropdown" class="dropdown-menu hidden absolute top-full left-0 mt-2 w-52 bg-bg-pane-light shadow-2xl rounded-md p-1 border border-border-color origin-top-left z-20">
                                <div class="px-2 py-2 border-b border-border-color">
                                    <p class="text-sm font-semibold text-text-primary">Signed in as</p>
                                    <p id="user-email-display" class="text-sm text-text-secondary truncate" title="user-email"></p>
                                </div>
                                <div class="p-1">
                                    <a href="#" id="sign-out-link" class="w-full text-left px-2 py-1.5 text-sm hover:bg-bg-pane-dark text-red-500 rounded flex items-center gap-2">
                                        <i data-feather="log-out" class="w-4 h-4"></i>
                                        <span>Sign Out</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <h1 class="text-lg font-bold text-text-primary">Notes</h1>
                    </div>
                    <div class="flex items-center gap-2 flex-shrink-0">
                        <div id="view-switcher-container" class="view-switcher bg-bg-pane-dark p-1 rounded-lg flex">

                            <!-- <button class="view-btn px-2.5 py-1 rounded" title="Calendar View" data-view="calendar"><i data-feather="calendar" class="w-4 h-4"></i></button> -->

                          <button class="view-btn px-2.5 py-1 rounded hidden md:flex" title="Board View" data-view="board"><i data-feather="trello" class="w-4 h-4"></i></button>
                          <button class="view-btn px-2.5 py-1 rounded" title="List View" data-view="list"><i data-feather="list" class="w-4 h-4"></i></button>
                        </div>
                        <button id="new-collection-btn" class="text-text-secondary hover:text-accent-primary transition-colors flex-shrink-0"><i data-feather="plus"></i></button>
                    </div>
                </header>
                <div id="collections-list-container" class="flex-grow p-2 overflow-y-auto custom-scrollbar"></div>


                
                <div id="tag-panel" class="p-2 border-t border-border-color flex-shrink-0">
    <div class="flex justify-between items-center px-2">
        <h3 class="font-bold text-sm uppercase tracking-wider py-1 text-text-secondary">Tags</h3>
        <button id="toggle-tags-btn" class="p-1 rounded-full hover:bg-bg-pane-dark">
            <i data-feather="chevron-down" class="w-4 h-4 transition-transform duration-200"></i>
        </button>
    </div>
    <div id="tag-list-container" class="mt-1 space-y-1 max-h-32 overflow-y-auto transition-all duration-300 custom-scrollbar"></div>
</div>

                <footer class="p-2 border-t border-border-color flex-shrink-0">
                    <div id="settings-panel">
                        <div class="flex justify-between items-center px-2">
                            <h3 class="font-bold text-sm uppercase tracking-wider py-1 text-text-secondary">Settings</h3>
                            <button id="toggle-settings-btn" class="p-1 rounded-full hover:bg-bg-pane-dark">
                                <i data-feather="chevron-down" class="w-4 h-4 transition-transform duration-200"></i>
                            </button>
                        </div>
                        <div id="settings-list-container" class="mt-1 space-y-1 transition-all duration-300">
                             <button id="theme-toggle" class="settings-footer-item">
                               <i data-feather="star" id="theme-reputify-icon" class="hidden w-5 h-5"></i>
                               <i data-feather="sun" id="theme-sun-icon" class="hidden w-5 h-5"></i>
                               <i data-feather="moon" id="theme-moon-icon" class="hidden w-5 h-5"></i>
                               <span id="theme-text">Reputify Theme</span>
                            </button>
                            <button data-action="import" class="settings-footer-item">
                                <i data-feather="upload" class="w-5 h-5"></i>
                                <span>Import Data</span>
                            </button>
                            <button data-action="export" class="settings-footer-item">
                                <i data-feather="download" class="w-5 h-5"></i>
                                <span>Export Data</span>
                            </button>
                            <button id="chatbot-toggle-btn" class="settings-footer-item">
        <i data-feather="message-square" class="w-5 h-5"></i>
        <span>Show Chatbot Button</span>
    </button>

                            <button id="bookmarklet-info-btn" class="settings-footer-item">
                                <i data-feather="book" class="w-5 h-5"></i>
                                <span>Web Clipper</span>
                            </button>
                            <button id="toggle-properties-btn" class="settings-footer-item">
                            <i data-feather="eye" class="w-5 h-5"></i>
                            <span>Hide Properties</span>
                        </button>
                        <button id="manage-sharing-btn" class="settings-footer-item">
    <i data-feather="share-2" class="w-5 h-5"></i>
    <span>Manage Sharing</span>
</button>
                        </div>
                    </div>
                    <input type="file" id="import-file-input" class="hidden" accept=".json" />
                </footer>
            </div>
        </aside>
        
        <div id="pane-resizer" class="w-1.5 h-full z-10 bg-transparent hidden md:block"></div>
        
        <button id="sidebar-toggle-btn" title="Toggle Sidebar" class="absolute top-1/2 -translate-y-1/2 w-6 h-12 bg-bg-pane-dark text-text-secondary flex items-center justify-center rounded-r-lg z-20 hidden md:flex">
            <i data-feather="chevron-left" class="w-5 h-5"></i>
        </button>

        <main id="editor-pane" class="flex-grow bg-bg-main flex flex-col">
           <header id="main-header" class="flex justify-between items-center p-4 border-b border-border-color flex-shrink-0 relative h-[65px]">
   <div id="header-main-content" class="flex justify-between items-center w-full transition-opacity duration-200">
       <div class="flex items-center gap-2 flex-shrink min-w-0">
         <button id="mobile-menu-button" class="md:hidden p-1 -ml-1"><i data-feather="menu" class="w-6 h-6"></i></button>
         <div class="flex items-center gap-2">
    <h2 id="current-view-title" class="text-lg font-semibold"></h2>
    <div id="save-indicator" title="Unsaved Changes"></div>
</div>
       </div>
       
       <div id="desktop-header-controls" class="hidden md:flex items-center gap-4">
           <div class="flex-grow"></div>
           <div class="flex items-center gap-2">
               <button id="header-search-icon" data-ripple="" class="p-2 hover:bg-bg-pane-dark rounded-lg text-text-secondary" title="Search (Cmd+F)"><i data-feather="search" class="w-4 h-4"></i></button>
               
               <div id="list-view-controls" class="hidden items-center gap-2">
                   <label for="sort-order" class="text-sm text-text-secondary">Sort by:</label>
                   <select id="sort-order" class="bg-bg-pane-dark text-text-primary text-sm rounded-md p-1 border-0 focus:ring-2 focus:ring-accent-primary">
                       <option value="modifiedAt-desc">Last Modified</option>
                       <option value="createdAt-desc">Date Created</option>
                       <option value="name-asc">Title (A-Z)</option>
                   </select>
               </div>
               
               <div class="editor-toolbar flex items-center bg-bg-pane-dark p-1 rounded-lg">
                <div class="relative" id="new-note-dropdown-container">
    <button id="desktop-new-note-btn" class="p-2 hover:bg-bg-main rounded-l-md" title="New Note (Cmd+N)">
        <i data-feather="file-plus" class="w-4 h-4"></i>
    </button>
    <div id="new-note-dropdown" class="dropdown-menu hidden absolute top-full left-0 mt-2 w-40 bg-bg-pane-light shadow-2xl rounded-md p-1 border border-border-color origin-top-left z-20">
        <button data-action="new-blank-note" class="w-full text-left px-3 py-1.5 text-sm hover:bg-bg-pane-dark rounded">New Blank Note</button>
        <button data-action="new-from-template" class="w-full text-left px-3 py-1.5 text-sm hover:bg-bg-pane-dark rounded">Saved Templates</button>
    </div>
</div>
                        <button id="history-btn" class="p-2 hover:bg-bg-main" title="Version History"><i data-feather="clock" class="w-4 h-4"></i></button>

                   
                   <button id="header-share-btn" class="p-2 hover:bg-bg-main" title="Share Note (Read-only)"><i data-feather="share-2" class="w-4 h-4"></i></button>
                   <button id="header-collaborate-btn" class="p-2 hover:bg-bg-main" title="Share &amp; Collaborate"><i data-feather="users" class="w-4 h-4"></i></button>

                   <div id="expandable-toolbar-buttons" class="hidden items-center">
                    <button id="header-summarize-btn" class="p-2 hover:bg-bg-main rounded-l-md" title="AI Summary"><i data-feather="zap" class="w-4 h-4"></i></button>
                   <button id="global-ai-btn" class="p-2 hover:bg-bg-main" title="Ask Your Notes (AI Search)"><i data-feather="message-circle" class="w-4 h-4"></i></button>
                   <button id="header-quiz-btn" class="p-2 hover:bg-bg-main" title="MCQ Quiz"><i data-feather="help-circle" class="w-4 h-4"></i></button>
                        <button id="dictate-btn" class="p-2 hover:bg-bg-main" title="Dictate Text"><i data-feather="mic" class="w-4 h-4"></i></button>
                        <button id="header-flashcard-btn" class="p-2 hover:bg-bg-main" title="Flashcard Mode"><i data-feather="copy" class="w-4 h-4"></i></button>
                        <button id="graph-btn" class="p-2 hover:bg-bg-main" title="Show Note Graph"><i data-feather="git-merge" class="w-4 h-4"></i></button>
                        <button id="header-checkpoint-btn" class="p-2 hover:bg-bg-main" title="Save Checkpoint"><i data-feather="flag" class="w-4 h-4"></i></button>
                        <button id="header-template-btn" class="p-2 hover:bg-bg-main" title="Save as Template"><i data-feather="save" class="w-4 h-4"></i></button>
                        <button id="editor-mode-toggle" class="p-2 hover:bg-bg-main disabled:opacity-50 disabled:cursor-not-allowed" title="Toggle Markdown Preview"><i data-feather="eye" class="w-4 h-4"></i></button>
                        <button data-command="ocr" class="p-2 hover:bg-bg-main" title="Scan Image for Text"><i data-feather="camera" class="w-4 h-4"></i></button>
                        <input type="file" id="ocr-file-input" class="hidden" accept="image/*" />
                   </div>

                   <button id="toggle-toolbar-btn" class="p-2 hover:bg-bg-main rounded-r-md">
                       <i id="toolbar-toggle-icon" data-feather="chevron-right" class="w-4 h-4"></i>
                   </button>
               </div>
               
               
           </div>
       </div>

       <div id="mobile-header-controls" class="flex md:hidden items-center gap-2 relative">
         <button id="mobile-search-icon" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="search" class="w-5 h-5"></i></button>
         <button id="mobile-global-ai-btn" class="p-2 rounded-full hover:bg-bg-pane-dark" title="Ask Your Notes"><i data-feather="message-circle" class="w-5 h-5"></i></button>
         <button id="mobile-more-button" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="more-vertical" class="w-5 h-5"></i></button>
         <div id="mobile-controls-dropdown" class="dropdown-menu hidden absolute top-full right-0 mt-2 w-48 bg-bg-pane-light shadow-2xl rounded-md p-2 border-border-color origin-top-right scale-95 opacity-0 z-30">
</div>

<div id="mobile-menu-fullscreen" class="">
    <div id="mobile-menu-fullscreen-header">
        <h2 id="mobile-menu-fullscreen-title">Actions</h2>
        <button id="mobile-menu-fullscreen-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark">
            <i data-feather="x" class="w-6 h-6"></i>
        </button>
    </div>
    <div id="mobile-menu-fullscreen-content" class="custom-scrollbar">
        </div>
</div>
       </div>
   </div>

    <div id="search-bar-container" class="hidden md:absolute md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 z-10 w-full md:w-[95%] md:max-w-[500px]">
         <div class="bg-bg-pane-dark rounded-full shadow-lg flex items-center px-4 w-full">
             <i data-feather="search" class="text-text-tertiary"></i>
             <input id="search-input" type="text" placeholder="Search notes and folders..." class="w-full bg-transparent p-3 focus:outline-none text-text-primary" />
             <button id="search-close-btn" class="p-2 -mr-2 rounded-full text-text-tertiary hover:bg-bg-main">
                <i data-feather="x" class="w-5 h-5"></i>
             </button>
         </div>
     </div>
</header>
<input type="file" id="file-upload-input" class="hidden" accept=".csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, image/*, .pdf, .txt, .md, **.zip,application/zip,application/x-zip-compressed**" />

           
           <div id="mobile-sticky-toolbar" class="hidden md:hidden sticky top-[65px] z-20 bg-bg-pane-dark p-2 border-b border-border-color">
    <div class="flex items-center gap-1 overflow-x-auto no-scrollbar">
        <button data-command="bold" class="p-2 hover:bg-bg-main rounded flex-shrink-0"><i data-feather="bold" class="w-4 h-4"></i></button>
        <button data-command="italic" class="p-2 hover:bg-bg-main rounded flex-shrink-0"><i data-feather="italic" class="w-4 h-4"></i></button>
        <button data-command="createLink" class="p-2 hover:bg-bg-main rounded flex-shrink-0"><i data-feather="link" class="w-4 h-4"></i></button>
        <button data-command="insertImage" class="p-2 hover:bg-bg-main rounded flex-shrink-0"><i data-feather="image" class="w-4 h-4"></i></button>
        <button id="mobile-attach-file-btn" class="p-2 hover:bg-bg-main rounded flex-shrink-0" title="Attach File"><i data-feather="paperclip" class="w-4 h-4"></i></button>
        <button data-command="formatBlock" data-value="code" class="p-2 hover:bg-bg-main rounded flex-shrink-0" title="Code Block"><i data-feather="code" class="w-4 h-4"></i></button>
        <button data-command="formatBlock" data-value="blockquote" class="p-2 hover:bg-bg-main rounded flex-shrink-0" title="Quote"><strong>“</strong></button>
        <button data-command="insertTable" class="p-2 hover:bg-bg-main rounded flex-shrink-0" title="Insert Table"><i data-feather="grid" class="w-4 h-4"></i></button>
        <button data-command="monospace" class="p-2 hover:bg-bg-main rounded font-mono font-bold flex-shrink-0" title="Monospace">M</button>
        <button data-command="insertChecklist" class="p-2 hover:bg-bg-main rounded flex-shrink-0" title="Checklist"><i data-feather="check-square" class="w-4 h-4"></i></button>
        <div class="w-px h-5 bg-border-color mx-1 flex-shrink-0"></div>
        <button data-command="textColor" data-value="red" class="p-1.5 hover:bg-bg-main rounded-full flex-shrink-0 toolbar-color-btn" title="Text Color Red"><span class="block w-4 h-4 rounded-full color-swatch-indicator" style="background-color: #F87171;"></span></button>
<button data-command="textColor" data-value="orange" class="p-1.5 hover:bg-bg-main rounded-full flex-shrink-0 toolbar-color-btn" title="Text Color Orange"><span class="block w-4 h-4 rounded-full color-swatch-indicator" style="background-color: #FB923C;"></span></button>
<button data-command="textColor" data-value="green" class="p-1.5 hover:bg-bg-main rounded-full flex-shrink-0 toolbar-color-btn" title="Text Color Green"><span class="block w-4 h-4 rounded-full color-swatch-indicator" style="background-color: #4ADE80;"></span></button>
<button data-command="textColor" data-value="blue" class="p-1.5 hover:bg-bg-main rounded-full flex-shrink-0 toolbar-color-btn" title="Text Color Blue"><span class="block w-4 h-4 rounded-full color-swatch-indicator" style="background-color: #60A5FA;"></span></button>
<button data-command="textColor" data-value="default" class="p-2 hover:bg-bg-main rounded flex-shrink-0" title="Default Color"><i data-feather="refresh-cw" class="w-4 h-4"></i></button>


        <div class="w-px h-5 bg-border-color mx-1 flex-shrink-0"></div>
        <button data-command="formatBlock" data-value="h1" class="p-2 hover:bg-bg-main rounded font-bold text-sm flex-shrink-0">H1</button>
        <button data-command="formatBlock" data-value="h2" class="p-2 hover:bg-bg-main rounded font-bold text-sm flex-shrink-0">H2</button>
        <button data-command="formatBlock" data-value="h3" class="p-2 hover:bg-bg-main rounded font-bold text-sm flex-shrink-0">H3</button>
    </div>
</div>
<div id="main-content-area" class="flex-grow overflow-y-auto relative flex flex-col custom-scrollbar">

            
                <div id="board-view" class="notes-view active flex-grow p-4 md:p-5 overflow-x-auto no-scrollbar h-full">
                    

                    <div id="kanban-board" class="flex gap-4 min-h-full"></div>
                </div>
                <div id="calendar-view" class="notes-view hidden flex-grow p-4 pb-24 md:p-5 flex flex-col"></div>
                <div id="gallery-view" class="notes-view hidden flex-grow p-4 md:p-5"></div>

                <div id="list-view" class="notes-view hidden flex-grow p-4 pb-24 md:p-5">
                    <div id="notes-list-content" class="space-y-4"></div>
                </div>
                <div id="note-editor-view" class="notes-view hidden flex-grow flex flex-col pb-24 md:pb-1">
                    <div id="highlight-controls" class="hidden sticky top-0 z-20 p-2 bg-bg-main">
<div id="in-note-search-bar" class="w-full mx-auto bg-bg-pane-dark shadow-lg rounded-full p-1 flex items-center gap-1 text-base border border-border-color px-4">
        <input id="in-note-search-input" type="text" placeholder="Find in note..." class="flex-grow bg-transparent rounded-full px-3 py-1 focus:outline-none" />
        <span id="in-note-search-count" class="text-text-tertiary w-20 text-center flex-shrink-0">No results</span>
        <div class="h-5 w-px bg-border-color"></div>
        <button id="in-note-search-prev" title="Previous" class="p-1 hover:bg-bg-main rounded-full text-text-secondary disabled:opacity-50" disabled=""><i data-feather="chevron-up" class="w-5 h-5"></i></button>
        <button id="in-note-search-next" title="Next" class="p-1 hover:bg-bg-main rounded-full text-text-secondary disabled:opacity-50" disabled=""><i data-feather="chevron-down" class="w-5 h-5"></i></button>
        <div class="h-5 w-px bg-border-color"></div>
        <button id="clear-search-btn" title="Close Search &amp; Clear Highlights" class="p-1 hover:bg-bg-main rounded-full text-text-tertiary mr-1">
            <i data-feather="x" class="w-5 h-5"></i>
        </button>
    </div>
</div>
                    <div class="w-full max-w-4xl mx-auto">
    <div class="p-4 md:p-8 md:pb-4 flex-shrink-0">
        <div id="note-properties-container" class="text-sm text-text-tertiary mb-4 py-2"></div>


        <textarea id="note-editor-title" placeholder="Untitled Note" class="text-3xl md:text-4xl font-bold bg-transparent focus:outline-none mb-4 w-full overflow-hidden resize-none" rows="1"></textarea>
    </div>
    <div id="note-editor-body" contenteditable="true" class="flex-grow text-lg leading-relaxed focus:outline-none px-4 md:px-8 pt-2 md:pt-4 pb-4 md:pb-8" data-placeholder="Start writing or drop an image..."></div>
</div>
                    <div id="markdown-preview" class="hidden flex-grow text-lg leading-relaxed focus:outline-none p-4 md:p-8 prose"></div>
                    <div id="heading-nav-pill" class="hidden fixed top-1/2 -translate-y-1/2 right-4 z-30 group">
    <div id="heading-nav-dots" class="flex flex-col items-center gap-2 bg-bg-pane-dark/50 backdrop-blur-sm p-1.5 rounded-full border border-border-color transition-opacity duration-200">
        </div>
    <div id="heading-nav-tooltip" class="absolute top-1/2 -translate-y-1/2 right-full mr-3 w-max bg-bg-pane-dark p-2 rounded-lg shadow-lg border border-border-color opacity-0 pointer-events-none transition-all duration-200">
        <div id="heading-nav-tooltip-content" class="flex flex-col gap-1">
            </div>
    </div>
</div>
                    <div id="backlinks-pane" class="hidden p-4 md:px-8 border-t border-border-color">
    <div class="flex justify-between items-center mb-3">
        <button id="toggle-backlinks-btn" class="flex items-center gap-2 text-left w-full">
            <i data-feather="chevron-down" class="w-4 h-4 transition-transform duration-200 text-text-tertiary"></i>
            <h4 class="font-semibold text-sm uppercase tracking-wider text-text-secondary">Linked Here</h4>
        </button>
    </div>
    <div id="backlinks-list" class="space-y-3 transition-all duration-300"></div>
</div>
                    <div id="editor-footer" class="p-4 text-xs text-text-tertiary text-left border-t border-border-color flex-shrink-0">
                        <div id="backlinks-pane" class="hidden p-4 md:px-8 border-t border-border-color">
    <h4 class="font-semibold text-sm uppercase tracking-wider text-text-secondary mb-3">Linked here</h4>
    <div id="backlinks-list" class="space-y-2"></div>
</div>
                       <span id="word-count">0</span> Words | <span id="char-count">0</span> Characters
                    </div>
                </div>
                <div id="search-results-view" class="notes-view hidden p-4 md:p-8">
                    <h2 class="text-2xl font-bold mb-6">Search Results</h2>
                    <div id="search-results-list"></div>
                </div>
           </div>
        </main>
        <div id="table-creator-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-sm z-50 transition-all duration-300 transform scale-95 opacity-0">
    <h3 class="text-lg font-semibold mb-4">Create Table</h3>
    <div class="grid grid-cols-2 gap-4">
        <div>
            <label for="table-rows" class="text-sm font-medium text-text-secondary">Rows</label>
            <input id="table-rows" type="number" value="3" min="1" class="w-full px-3 py-2 mt-1 bg-bg-pane-dark border border-border-color rounded-md focus:outline-none focus:ring-2 focus:ring-accent-primary" />
        </div>
        <div>
            <label for="table-cols" class="text-sm font-medium text-text-secondary">Columns</label>
            <input id="table-cols" type="number" value="2" min="1" class="w-full px-3 py-2 mt-1 bg-bg-pane-dark border border-border-color rounded-md focus:outline-none focus:ring-2 focus:ring-accent-primary" />
        </div>
    </div>
    <div class="flex justify-end gap-3 mt-6">
        <button id="table-cancel-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80">Cancel</button>
        <button id="table-create-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90">Create</button>
    </div>
</div>
    </div><div id="public-note-view" class="hidden min-h-screen bg-bg-main text-text-primary">
    <!-- START: NEW HEADER FOR PUBLIC PAGE -->
    <header class="sticky top-0 z-10 bg-bg-main py-4 px-4 md:px-8 border-b border-border-color shadow-sm">
        
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <a href="https://reputifly.org/note" title="Back to Reputifly">
                <img src="https://reputifly.com/wp-content/uploads/2025/05/cropped-reputifly-new-e1746390492876.png" alt="Reputifly Logo" class="h-8 w-auto" />
            </a>
            <a href="https://reputifly.org/note" class="brand-button text-white font-semibold px-4 py-2 rounded-lg text-sm hover:opacity-90 transition-opacity">
                Sign Up Free
            </a>
        </div>
    </header>
    <!-- END: NEW HEADER FOR PUBLIC PAGE -->

    <main class="max-w-4xl mx-auto p-4 md:p-8">
        <!-- Title will be populated by JS -->
        <h1 id="public-note-title" class="text-3xl md:text-4xl font-bold mb-6 border-b border-border-color pb-4"></h1>
        
        <button id="copy-note-btn" class="flex items-center gap-2 mb-4 text-sm text-text-secondary hover:text-text-primary transition">
            <i data-feather="copy" class="w-4 h-4"></i>
            <span>Copy Content</span>
        </button>
        
        <!-- Note content will be populated by JS. `max-w-none` ensures content fills the container. -->
        <div id="public-note-content" class="prose max-w-none"></div>

        <!-- Call to action section -->
        <div class="mt-16 p-6 bg-bg-pane-dark rounded-lg text-center">
            <h3 class="font-bold text-xl text-text-primary">Enjoying this note?</h3>
            <p class="text-text-secondary mt-2 mb-4">Create your own smart notes with AI summaries, quizzes, and more.</p>
            <a href="https://reputifly.org/signup" class="brand-button inline-block text-white font-semibold px-5 py-2.5 rounded-lg hover:opacity-90 transition-opacity">
                Create a Free Account
            </a>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-12 text-sm text-text-tertiary">
            <p>Published with Reputifly AI Note Taker</p>
        </footer>
    </main>
</div>
    
    <button id="chatbot-fab" title="Ask Chatbot" class="bg-gradient-to-r from-[var(--brand-grad-from)] to-[var(--brand-grad-to)] fixed bottom-6 right-6 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center z-20 hover:opacity-90 transition-opacity">
        <i data-feather="message-square" class="w-7 h-7"></i>
    </button>
    
    
    <div id="modal-backdrop" class="fixed inset-0 bg-black/50 z-[998] transition-opacity duration-300 opacity-0 pointer-events-none"></div>
    <div id="mobile-sidebar-overlay" class="fixed inset-0 bg-black/30 z-30 hidden md:hidden transition-opacity duration-300 opacity-0 pointer-events-none"></div>
    
    <div id="api-key-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-md z-50 transition-all duration-300 transform scale-95 opacity-100">
        <h3 class="text-lg font-semibold mb-2">Gemini API Key Required</h3>
        <p class="text-sm text-text-secondary mb-4">Please enter your Gemini API key to enable AI features. Your key is stored only in your browser's local storage.</p>
        <label for="api-key-input" class="text-xs font-semibold text-text-secondary">API Key</label>
        <input id="api-key-input" type="password" class="w-full text-sm bg-bg-pane-dark border border-border-color rounded-md py-1 px-2 focus:ring-2 focus:ring-accent-primary focus:outline-none" placeholder="Enter your key here..." />
        <p id="api-key-error" class="text-red-500 text-sm mt-1 h-5"></p>
        <div class="flex justify-end gap-3 mt-4">
            <button id="api-key-confirm-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90">Save and Continue</button>
        </div>
    </div>
    
    <div id="prompt-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-md z-[60] transition-all duration-300 transform scale-95 opacity-0">
        <h3 id="prompt-title" class="text-lg font-semibold mb-4">Input Required</h3>
        <p id="prompt-message" class="text-sm text-text-secondary mb-3"></p>
        <input id="prompt-input" type="text" autocomplete="off" class="w-full bg-bg-pane-dark border border-border-color rounded-md p-2 focus:ring-2 focus:ring-accent-primary focus:outline-none" />
        <p id="prompt-error" class="text-red-500 text-sm mt-1 h-5"></p>
        <div class="flex justify-end gap-3 mt-4">
            <button id="prompt-cancel-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80">Cancel</button>
            <button id="prompt-confirm-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90">Confirm</button>
        </div>
    </div>
    <div id="confirm-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-md z-60 transition-all duration-300 transform scale-95 opacity-0">
        <h3 id="confirm-title" class="text-lg font-semibold mb-4">Are you sure?</h3>
        <p id="confirm-message" class="text-sm text-text-secondary mb-6"></p>
        <div class="flex justify-end gap-3 mt-4">
            <button id="confirm-cancel-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80">Cancel</button>
            <button id="confirm-confirm-btn" class="px-4 py-2 rounded-md bg-red-600 text-white hover:opacity-90">Delete</button>
        </div>
    </div>
    <div id="bookmarklet-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-lg z-50 transition-all duration-300 transform scale-95 opacity-0">
        <h3 class="text-lg font-semibold mb-2 flex items-center gap-2"><i data-feather="book" class="w-5 h-5 text-accent-primary"></i>Web Clipper Bookmarklet</h3>
        <p class="text-sm text-text-secondary mb-4">Drag the link below to your browser's bookmarks bar to create a web clipper. When you're on any website, click the bookmarklet to clip selected text into a new note.</p>
        <a id="bookmarklet-link" href="#" class="inline-block brand-button text-white font-semibold px-4 py-2 rounded-lg text-sm">Clip to Reputifly Notes</a>
        <div class="mt-4 flex justify-end">
            <button id="bookmarklet-close-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80">Close</button>
        </div>
    </div>
    <div id="graph-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-4 rounded-lg shadow-2xl w-[90vw] max-w-3xl h-[60vh] z-50 transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
        <header class="flex justify-between items-center mb-2 flex-shrink-0">
            <h3 class="text-lg font-semibold flex items-center gap-2"><i data-feather="git-merge" class="w-5 h-5 text-accent-primary"></i>Note Graph</h3>
            <button id="graph-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
        </header>
        <div id="graph-container" class="border border-border-color rounded-md flex-grow bg-bg-main"></div>
    </div>
    <div id="ai-prompt-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-lg z-50 transition-all duration-300 transform scale-95 opacity-0">
        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2"><i data-feather="sparkles" class="w-5 h-5 text-accent-primary"></i>Ask AI</h3>
        <p class="text-sm text-text-secondary mb-3">Enter your prompt below. The AI-generated content will be inserted into your note.</p>
        <textarea id="ai-prompt-input" rows="4" class="w-full bg-bg-pane-dark border border-border-color rounded-md p-2 focus:ring-2 focus:ring-accent-primary focus:outline-none" placeholder="e.g., 'Write a short poem about the moon'"></textarea>
        <p id="ai-prompt-error" class="text-red-500 text-sm mt-1 h-5"></p>
        <div class="flex justify-end gap-3 mt-4">
            <button id="ai-cancel-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80">Cancel</button>
            <button id="ai-generate-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90 flex items-center gap-2">
                <i data-feather="play" class="w-4 h-4"></i>
                <span id="ai-generate-btn-text">Generate</span>
            </button>
        </div>
    </div>
    <div id="summary-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-xl z-50 transition-all duration-300 transform scale-95 opacity-0">
    <h3 class="text-lg font-semibold mb-2 flex items-center gap-2"><i data-feather="align-left" class="w-5 h-5 text-accent-primary"></i>AI Summary</h3>
    
    <div class="relative">
        <div id="summary-content" class="text-sm text-text-secondary mb-4 bg-bg-pane-dark p-4 rounded-md max-h-[50vh] overflow-y-auto"></div>
        <button id="summary-copy-btn" class="ai-response-copy-btn hidden" title="Copy Summary">
            <i data-feather="copy" class="w-4 h-4"></i>
        </button>
    </div>
    <footer class="flex justify-end gap-3 mt-4">
        <button id="summary-close-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90">Close</button>
    </footer>
</div>
    <div id="chatbot-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light rounded-lg shadow-2xl w-[90vw] max-w-2xl h-[70vh] z-50 transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
        <header class="p-4 border-b border-border-color flex justify-between items-center flex-shrink-0">
            <h3 class="text-lg font-semibold flex items-center gap-2"><i data-feather="message-square" class="w-5 h-5 text-accent-primary"></i>Chat with AI</h3>
            <div class="flex items-center">
                <button id="chatbot-clear-btn" class="p-2 rounded-full hover:bg-bg-pane-dark" title="Clear Chat History"><i data-feather="trash-2" class="w-5 h-5"></i></button>
                <button id="chatbot-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
            </div>
        </header>
        <div id="chatbot-history" class="flex-grow p-4 space-y-4 overflow-y-auto">
        </div>
        <footer class="p-4 border-t border-border-color flex-shrink-0">
            <div id="chatbot-error" class="text-red-500 text-sm mb-2 h-5"></div>
            <div id="chatbot-context-pills" class="flex flex-wrap gap-1 mb-2"></div>
            <div class="flex items-center gap-2">
                <button id="chatbot-add-context-btn" title="Add Note Context" class="text-text-secondary hover:text-accent-primary p-2 rounded-full hover:bg-bg-main flex-shrink-0"><i data-feather="plus-circle" class="w-5 h-5"></i></button>
                <input id="chatbot-input" type="text" class="w-full bg-bg-pane-dark border border-border-color rounded-full py-2 px-4 focus:ring-2 focus:ring-accent-primary focus:outline-none" placeholder="Ask anything..." />
                <button id="chatbot-send-btn" class="bg-gradient-to-r from-[var(--brand-grad-from)] to-[var(--brand-grad-to)] text-white rounded-full w-10 h-10 flex-shrink-0 flex items-center justify-center hover:opacity-90">
                    <i data-feather="arrow-up" class="w-5 h-5"></i>
                </button>
            </div>
        </footer>
    </div>
    
    <div id="toast-container" class="fixed top-4 left-1/2 -translate-x-1/2 z-[1000] transition-all duration-300 ease-in-out origin-top flex flex-col items-center gap-2" style="pointer-events: none;"></div>    
    <div id="inline-toolbar" class="absolute z-30 bg-bg-pane-dark p-1 rounded-lg shadow-md flex items-center gap-1 transition-all duration-150 transform scale-95 opacity-0" style="pointer-events: none;">
    <button id="toolbar-scroll-left" class="toolbar-scroll-btn hidden p-2"><i data-feather="chevron-left" class="w-4 h-4"></i></button>
    
    <div id="inline-toolbar-buttons" class="flex items-center gap-1 overflow-x-auto no-scrollbar">
        <button data-command="bold" class="p-2 hover:bg-bg-main rounded flex-shrink-0"><i data-feather="bold" class="w-4 h-4"></i></button>
        <button data-command="italic" class="p-2 hover:bg-bg-main rounded flex-shrink-0"><i data-feather="italic" class="w-4 h-4"></i></button>
        <button data-command="createLink" class="p-2 hover:bg-bg-main rounded flex-shrink-0"><i data-feather="link" class="w-4 h-4"></i></button>
        <button data-command="insertImage" class="p-2 hover:bg-bg-main rounded flex-shrink-0"><i data-feather="image" class="w-4 h-4"></i></button>
        <button id="attach-file-btn" class="p-2 hover:bg-bg-main rounded flex-shrink-0" title="Attach File"><i data-feather="paperclip" class="w-4 h-4"></i></button>
        <button data-command="formatBlock" data-value="code" class="p-2 hover:bg-bg-main rounded flex-shrink-0" title="Code Block"><i data-feather="code" class="w-4 h-4"></i></button>
        <button data-command="formatBlock" data-value="blockquote" class="p-2 hover:bg-bg-main rounded flex-shrink-0" title="Quote"><strong>“</strong></button>
        <button data-command="insertTable" class="p-2 hover:bg-bg-main rounded flex-shrink-0" title="Insert Table"><i data-feather="grid" class="w-4 h-4"></i></button>
        <button data-command="monospace" class="p-2 hover:bg-bg-main rounded font-mono font-bold flex-shrink-0" title="Monospace">M</button>
        <button data-command="insertChecklist" class="p-2 hover:bg-bg-main rounded flex-shrink-0" title="Checklist"><i data-feather="check-square" class="w-4 h-4"></i></button>
        <div class="w-px h-5 bg-border-color mx-1 flex-shrink-0"></div>
        
        <button data-command="textColor" data-value="red" class="p-1.5 hover:bg-bg-main rounded-full flex-shrink-0 toolbar-color-btn" title="Text Color Red"><span class="block w-4 h-4 rounded-full color-swatch-indicator" style="background-color: #F87171;"></span></button>
<button data-command="textColor" data-value="orange" class="p-1.5 hover:bg-bg-main rounded-full flex-shrink-0 toolbar-color-btn" title="Text Color Orange"><span class="block w-4 h-4 rounded-full color-swatch-indicator" style="background-color: #FB923C;"></span></button>
<button data-command="textColor" data-value="green" class="p-1.5 hover:bg-bg-main rounded-full flex-shrink-0 toolbar-color-btn" title="Text Color Green"><span class="block w-4 h-4 rounded-full color-swatch-indicator" style="background-color: #4ADE80;"></span></button>
<button data-command="textColor" data-value="blue" class="p-1.5 hover:bg-bg-main rounded-full flex-shrink-0 toolbar-color-btn" title="Text Color Blue"><span class="block w-4 h-4 rounded-full color-swatch-indicator" style="background-color: #60A5FA;"></span></button>
<button data-command="textColor" data-value="default" class="p-2 hover:bg-bg-main rounded flex-shrink-0" title="Default Color"><i data-feather="refresh-cw" class="w-4 h-4"></i></button>


        <div class="w-px h-5 bg-border-color mx-1 flex-shrink-0"></div>
        <button data-command="formatBlock" data-value="h1" class="p-2 hover:bg-bg-main rounded font-bold text-sm flex-shrink-0">H1</button>
        <button data-command="formatBlock" data-value="h2" class="p-2 hover:bg-bg-main rounded font-bold text-sm flex-shrink-0">H2</button>
        <button data-command="formatBlock" data-value="h3" class="p-2 hover:bg-bg-main rounded font-bold text-sm flex-shrink-0">H3</button>
        
    </div>

    <button id="toolbar-scroll-right" class="toolbar-scroll-btn hidden p-2"><i data-feather="chevron-right" class="w-4 h-4"></i></button>
</div>

    <div id="context-menu" class="context-menu fixed z-50 bg-bg-pane-light shadow-2xl rounded-md p-2 w-48 border border-border-color hidden origin-top-left scale-95 opacity-0">
        <button data-action="new-note" class="w-full text-left px-3 py-1.5 text-sm hover:bg-bg-pane-dark rounded flex items-center gap-2"><i data-feather="file-plus" class="w-4 h-4"></i>New Note</button>
        <button data-action="new-folder" class="w-full text-left px-3 py-1.5 text-sm hover:bg-bg-pane-dark rounded flex items-center gap-2"><i data-feather="folder-plus" class="w-4 h-4"></i>New Folder</button>
        <hr class="my-1 border-border-color" />
        <button data-action="toggle-pin" class="w-full text-left px-3 py-1.5 text-sm hover:bg-bg-pane-dark rounded flex items-center gap-2"><i data-feather="paperclip" class="w-4 h-4"></i><span id="pin-action-text">Pin</span></button>
        <button data-action="duplicate" class="w-full text-left px-3 py-1.5 text-sm hover:bg-bg-pane-dark rounded flex items-center gap-2"><i data-feather="copy" class="w-4 h-4"></i>Duplicate</button>
        <button data-action="save-as-template" class="w-full text-left px-3 py-1.5 text-sm hover:bg-bg-pane-dark rounded flex items-center gap-2"><i data-feather="save" class="w-4 h-4"></i>Save as Template</button>
        <button data-action="rename" class="w-full text-left px-3 py-1.5 text-sm hover:bg-bg-pane-dark rounded flex items-center gap-2"><i data-feather="edit-2" class="w-4 h-4"></i>Rename</button>
        <button data-action="delete" class="w-full text-left px-3 py-1.5 text-sm hover:bg-bg-pane-dark text-red-500 rounded flex items-center gap-2"><i data-feather="trash-2" class="w-4 h-4"></i>Delete</button>
    </div>
    <div id="quiz-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-2xl z-50 transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header class="flex justify-between items-center mb-4 flex-shrink-0">
        <h3 class="text-lg font-semibold flex items-center gap-2"><i data-feather="help-circle" class="w-5 h-5 text-accent-primary"></i>MCQ Quiz</h3>
        <button id="quiz-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>
    <div id="quiz-content" class="text-text-secondary mb-4 p-1 rounded-md max-h-[60vh] overflow-y-auto custom-scrollbar">
        </div>
    <footer class="flex justify-end gap-3 mt-4 flex-shrink-0">
        <button id="quiz-done-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90">Done</button>
    </footer>
</div>
<div id="flashcard-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-xl z-50 transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header class="flex justify-between items-center mb-4 flex-shrink-0">
        <h3 class="text-lg font-semibold flex items-center gap-2"><i data-feather="copy" class="w-5 h-5 text-accent-primary"></i>Flashcards</h3>
        <button id="flashcard-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>
    <div id="flashcard-content" class="flex-grow flex flex-col items-center justify-center">
        <div id="flashcard-container" class="w-full h-64 perspective-1000">
            <div id="flashcard" class="relative w-full h-full text-center transition-transform duration-700 transform-style-3d">
                <div id="flashcard-front" class="flashcard-face absolute w-full h-full backface-hidden bg-bg-pane-dark rounded-lg p-4 flex items-center justify-center"></div>
                <div id="flashcard-back" class="flashcard-face absolute w-full h-full backface-hidden bg-bg-pane-dark rounded-lg p-4 flex items-center justify-center transform rotate-y-180"></div>
            </div>
        </div>
    </div>
    <footer class="flex justify-between items-center mt-4 flex-shrink-0">
        <div id="flashcard-progress" class="text-sm text-text-secondary"></div>
        <div class="flex gap-3">
            <button id="flashcard-prev-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80">Previous</button>
            <button id="flashcard-next-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90">Next</button>
        </div>
    </footer>
</div>
<div id="global-ai-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-2xl z-50 transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header class="flex justify-between items-center mb-4 flex-shrink-0">
        <h3 class="text-lg font-semibold flex items-center gap-2"><i data-feather="message-circle" class="w-5 h-5 text-accent-primary"></i>Ask Your Notes</h3>
        <button id="global-ai-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>
    
    <div class="modal-content-area custom-scrollbar flex-grow flex flex-col gap-4 p-1">
        <div>
            <label for="global-ai-input" class="text-sm font-medium text-text-secondary">Your Question</label>
            <textarea id="global-ai-input" rows="3" class="w-full mt-1 bg-bg-pane-dark border border-border-color rounded-md p-2 focus:ring-2 focus:ring-accent-primary focus:outline-none" placeholder="e.g., What was the design strategy for Project Centauri?"></textarea>
        </div>
        
        <div id="global-ai-answer-container" class="hidden">
            <label class="text-sm font-medium text-text-secondary">Answer from your notes</label>
            <div class="relative">
                <div id="global-ai-answer" class="text-text-secondary mt-1 bg-bg-pane-dark p-4 rounded-md prose max-w-none"></div>
                <button id="global-ai-copy-btn" class="ai-response-copy-btn hidden" title="Copy Answer">
                    <i data-feather="copy" class="w-4 h-4"></i>
                </button>
            </div>
        </div>

        <div id="global-ai-sources-container" class="hidden">
             <label class="text-sm font-medium text-text-secondary">Sources</label>
             <div id="global-ai-sources" class="mt-1 space-y-2"></div>
        </div>
    </div>
    <footer class="flex justify-between items-center mt-6 flex-shrink-0 pt-4 border-t border-border-color">
    <button id="global-ai-copy-btn-footer" class="hidden flex items-center gap-2 px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80">
        <i data-feather="copy" class="w-4 h-4"></i>Copy Answer
    </button>
    <button id="global-ai-ask-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90 flex items-center gap-2 ml-auto">
        <span id="global-ai-btn-text">Ask</span>
    </button>
</footer>
</div>


    
    

<div id="agent-forge-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-0 rounded-xl shadow-2xl w-screen h-screen md:w-[90vw] md:h-[85vh] md:max-w-4xl z-50 transition-all duration-300 transform scale-95 opacity-0 flex flex-col overflow-hidden border border-border-color">
    
    <header class="flex justify-between items-center p-5 border-b border-border-color flex-shrink-0 bg-gradient-to-b from-[rgba(255,255,255,0.05)] to-transparent">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-accent-primary to-accent-primary-dark flex items-center justify-center">
                <i data-feather="box" class="w-6 h-6 text-white"></i>
            </div>
            <div>
                <h3 class="text-lg font-bold text-text-primary">AI Agent Forge</h3>
                <p class="text-sm text-text-secondary">Construct your personal AI assistant</p>
            </div>
        </div>
        <button id="agent-forge-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark text-text-secondary hover:text-text-primary transition-colors"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>

    <div id="agent-forge-main-content" class="flex-grow flex flex-col md:flex-row min-h-0">
    <div class="flex-1 flex flex-col p-5 overflow-y-auto custom-scrollbar">
        <div class="flex-shrink-0 border-b-2 border-border-color">
            <nav id="agent-forge-tabs" class="-mb-0.5 flex space-x-4">
                <button class="forge-tab-btn active whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm text-text-secondary border-transparent hover:border-accent-primary" data-tab="step-builder">
                    <i data-feather="git-commit" class="w-4 h-4 mr-2 inline-block"></i>Step Builder
                </button>
                <button class="forge-tab-btn whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm text-text-secondary border-transparent hover:border-accent-primary" data-tab="manual">
                    Instructions
                </button>
                <button class="forge-tab-btn whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm text-text-secondary border-transparent hover:border-accent-primary" data-tab="helper">
                    Instruction Helper
                </button>
            </nav>
        </div>
        <div class="flex-grow pt-5 flex flex-col gap-5 min-h-0">
<div id="tab-step-builder" class="forge-tab-content active flex-grow flex flex-col gap-4">

    <div class="flex-grow flex flex-col gap-3 min-h-0">
        <div class="flex items-center justify-between">
            <div>
                <label class="text-sm font-semibold text-text-secondary">Agent Workflow</label>
                <p class="text-xs text-text-tertiary">Add and arrange the steps your agent will perform.</p>
            </div>
            <button id="agent-generate-from-steps-btn" class="brand-button text-sm py-2 px-4 flex items-center gap-2">
                <i data-feather="arrow-right-circle" class="w-4 h-4"></i>
                <span>Generate Instructions</span>
            </button>
        </div>
        <div id="agent-step-container" class="flex-grow space-y-3 p-3 bg-bg-main rounded-md border border-border-color overflow-y-auto custom-scrollbar">
            <div id="agent-step-placeholder" class="text-center p-8 text-text-tertiary border-2 border-dashed border-border-color rounded-lg">
                <i data-feather="mouse-pointer" class="w-8 h-8 mx-auto mb-2"></i>
                <p class="font-semibold">Your workflow is empty</p>
                <p class="text-sm">Click "Add Step" to begin building your agent.</p>
            </div>
        </div>
    </div>

    <div class="flex-shrink-0 mt-4 mb-4">
        <button id="agent-add-step-btn" class="w-full flex items-center justify-center gap-2 p-2 rounded-md text-sm text-text-secondary hover:bg-bg-pane-dark border border-border-color transition-colors">
            <i data-feather="plus" class="w-4 h-4"></i>
            <span>Add Step</span>
        </button>
    </div>
    
    <div class="flex-shrink-0 p-3 bg-bg-pane-dark rounded-md border border-border-color">
        <div class="flex items-start justify-between gap-4">
            <div class="flex-grow">
                <label for="agent-goal-input" class="text-sm font-semibold text-text-secondary">Agent's Overall Goal</label>
                <p class="text-xs text-text-tertiary mb-2">Describe the agent's main purpose. This provides crucial context.</p>
                <input type="text" id="agent-goal-input" class="w-full bg-bg-main border border-border-color rounded-md p-2 text-sm focus:ring-1 focus:ring-accent-primary focus:outline-none" placeholder="e.g., Draft a blog post from my ideas and research." />
            </div>
            <div class="flex-shrink-0 text-center">
                <label class="text-sm font-semibold text-text-secondary">Context</label>
                 <p class="text-xs text-text-tertiary mb-2">Private knowledge</p>
                <button id="agent-add-context-btn" class="w-full px-3 py-2 text-sm hover:bg-bg-main rounded-md flex items-center gap-2 border border-border-color transition-colors">
                    <i data-feather="plus" class="w-4 h-4 text-text-tertiary"></i>Add Note
                </button>
            </div>
        </div>
        <div id="agent-context-pills" class="flex flex-wrap gap-2 mt-2 empty:hidden"></div>
    </div>

</div>
            <div id="tab-manual" class="forge-tab-content flex-grow flex flex-col gap-5">
                <div class="flex-grow flex flex-col">
                    <label for="agent-instructions-input" class="text-sm font-semibold text-text-secondary">Instructions</label>
                    <p class="text-xs text-text-tertiary mb-2">Describe the steps for your agent in plain English.</p>
                    <textarea id="agent-instructions-input" class="w-full flex-grow bg-bg-pane-dark border border-border-color rounded-md p-3 text-base leading-relaxed focus:ring-2 focus:ring-accent-primary focus:outline-none custom-scrollbar" placeholder="e.g.,&#10;1. Create a note named 'Daily Journal'.&#10;2. Ask the AI for a Stoic quote.&#10;3. Append the quote to the note."></textarea>
                </div>
            </div>

            <div id="tab-helper" class="forge-tab-content flex-grow flex flex-col">
                <label class="text-sm font-semibold text-text-secondary">Describe Your Goal</label>
                <p class="text-xs text-text-tertiary mb-2">The helper will draft the manual instructions for you.</p>
                <textarea id="agent-guide-input" rows="3" class="w-full bg-bg-pane-dark border border-border-color rounded-md p-2 text-base leading-relaxed focus:ring-2 focus:ring-accent-primary focus:outline-none custom-scrollbar" placeholder="e.g., Find my latest meeting notes, summarize them, and create a new note with the summary."></textarea>
                <button id="agent-guide-generate-btn" class="brand-button w-full text-sm py-2 mt-2">Generate Instructions</button>
                <div id="agent-guide-output-container" class="hidden mt-3 flex-grow flex flex-col min-h-0">
                    <label class="text-xs font-semibold text-text-secondary">Suggested Instructions:</label>
                    <div id="agent-guide-output" class="flex-grow text-sm bg-bg-pane-dark p-2 rounded-md mt-1 border border-border-color overflow-y-auto custom-scrollbar whitespace-pre-wrap"></div>
                    <button id="agent-guide-use-btn" class="w-full text-left px-3 py-1.5 text-sm hover:bg-bg-pane-dark rounded flex items-center gap-2 mt-2 border border-border-color">
                        <i data-feather="arrow-down-circle" class="w-4 h-4"></i>Use These Instructions
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="flex-1 flex flex-col bg-bg-pane-dark p-4 rounded-lg border-l border-border-color m-5 ml-0">
        <label class="text-sm font-semibold text-text-secondary mb-2 flex items-center gap-2"><i data-feather="activity" class="w-4 h-4"></i>Live Log</label>
        <div id="agent-forge-logs" class="flex-grow rounded-md text-sm text-text-secondary font-mono overflow-y-auto custom-scrollbar pr-2">
            <div class="forge-placeholder">Awaiting instructions...</div>
        </div>
    </div>
</div>

<footer class="flex justify-end items-center p-5 border-t border-border-color flex-shrink-0 bg-gradient-to-t from-[rgba(255,255,255,0.05)] to-transparent gap-4">
    <button id="agent-forge-save-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80 flex items-center gap-2">
        <i data-feather="save" class="w-4 h-4"></i>
        <span>Save Blueprint</span>
    </button>
    <button id="agent-forge-run-btn" class="px-6 py-3 rounded-lg font-bold text-white transition-all duration-300 transform hover:scale-105" style="background-image: linear-gradient(to right, var(--brand-grad-from), var(--brand-grad-to)); box-shadow: 0 4px 15px -5px var(--accent-primary);">
        <div class="flex items-center gap-2">
            <i data-feather="play-circle" class="w-5 h-5"></i>
            <span>Execute Agent</span>
        </div>
    </button>
</footer>
</div>
<div id="command-prompt-container" class="hidden fixed bottom-5 left-1/2 -translate-x-1/2 w-[90%] max-w-lg z-50">
    <div class="relative">
        <div id="command-suggestions" class="hidden absolute bottom-full left-0 w-full mb-1 bg-bg-pane-dark rounded-md shadow-lg p-1 border border-border-color max-h-60 overflow-y-auto custom-scrollbar">
            </div>
        <div class="flex items-center gap-2 bg-bg-pane-dark p-2 rounded-lg shadow-2xl border border-border-color">
            <i data-feather="slash" class="w-5 h-5 text-text-tertiary"></i>
            <input type="text" id="command-input" class="w-full bg-transparent focus:outline-none text-text-primary" placeholder="Type a command..." autocomplete="off" />
        </div>
    </div>
</div>
<div id="link-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-4 rounded-lg shadow-2xl w-[90vw] max-w-lg z-50 transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header class="flex justify-between items-center mb-3 flex-shrink-0">
        <h3 class="text-lg font-semibold">Link</h3>
        <button id="link-modal-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>
    <div class="relative flex-shrink-0 mb-2">
        <i data-feather="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-text-tertiary"></i>
        <input type="text" id="link-modal-input" placeholder="Paste link or search notes" class="w-full bg-bg-main border border-border-color rounded-md py-2 pl-9 pr-3 text-sm focus:outline-none focus:ring-1 focus:ring-accent-primary" />
    </div>
    <div id="link-modal-results" class="flex-grow overflow-y-auto custom-scrollbar -mr-2 pr-2">
        </div>
</div>
<div id="linked-notes-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-lg z-50 transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header class="flex justify-between items-center mb-4 flex-shrink-0">
        <h3 id="linked-notes-title" class="text-lg font-semibold flex items-center gap-2"><i data-feather="link" class="w-5 h-5 text-accent-primary"></i>Note Connections</h3>
        <button id="linked-notes-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>
    <div id="linked-notes-content" class="flex-grow space-y-4 overflow-y-auto">
        </div>
</div>

<div id="help-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-2xl z-50 transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header class="flex justify-between items-center mb-4 flex-shrink-0">
        <h3 class="text-lg font-semibold flex items-center gap-2"><i data-feather="terminal" class="w-5 h-5 text-accent-primary"></i>Command List</h3>
        <button id="help-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>
    <div id="help-content" class="flex-grow space-y-2 overflow-y-auto max-h-[60vh] custom-scrollbar">


        </div>
</div>
<!-- START: New Table Context Menu -->
<div id="table-context-menu" class="context-menu fixed z-50 bg-bg-pane-light shadow-2xl rounded-md p-1 border border-border-color hidden origin-top-left scale-95 opacity-0 text-sm">
    <div id="table-row-actions">
    <div class="table-menu-item" data-action="add-row-above"><i data-feather="arrow-up"></i>Insert Row Above</div>
    <div class="table-menu-item" data-action="add-row-below"><i data-feather="arrow-down"></i>Insert Row Below</div>
    <div class="table-menu-item" data-action="duplicate-row"><i data-feather="copy"></i>Duplicate Row</div>
    <div class="table-menu-item with-submenu">
        <i data-feather="edit-3"></i><span>Highlight Row</span><i data-feather="chevron-right" class="submenu-arrow"></i>
        <div class="submenu">
            <div class="table-menu-item" data-action="highlight" data-color="yellow"><span class="color-swatch bg-highlight-yellow"></span>Yellow</div>
            <div class="table-menu-item" data-action="highlight" data-color="green"><span class="color-swatch bg-highlight-green"></span>Green</div>
            <div class="table-menu-item" data-action="highlight" data-color="blue"><span class="color-swatch bg-highlight-blue"></span>Blue</div>
            <div class="table-menu-item" data-action="highlight" data-color="red"><span class="color-swatch bg-highlight-red"></span>Red</div>
            <hr class="my-1 border-border-color" />
            <div class="table-menu-item" data-action="highlight" data-color="none">Clear Highlight</div>
        </div>
    </div>
    <hr class="my-1 border-border-color" />
    <div class="table-menu-item text-red-500" data-action="delete-row"><i data-feather="trash-2"></i>Delete Row</div>
</div>
    <div id="table-col-actions" class="hidden">
        <div class="table-menu-item" data-action="add-col-left"><i data-feather="arrow-left"></i>Insert Column Left</div>
        <div class="table-menu-item" data-action="add-col-right"><i data-feather="arrow-right"></i>Insert Column Right</div>
        <div class="table-menu-item" data-action="duplicate-col"><i data-feather="copy"></i>Duplicate Column</div>
        <div class="table-menu-item with-submenu">
             <i data-feather="plus-circle"></i><span>Calculate</span><i data-feather="chevron-right" class="submenu-arrow"></i>
             <div class="submenu">
                <div class="table-menu-item" data-action="calculate" data-calc="sum">Sum</div>
                <div class="table-menu-item" data-action="calculate" data-calc="avg">Average</div>
                <div class="table-menu-item" data-action="calculate" data-calc="count">Count</div>
                <div class="table-menu-item" data-action="custom-calc">Custom Calculation</div>
                <hr class="my-1 border-border-color" />
                <div class="table-menu-item" data-action="calculate" data-calc="clear">Clear Calculation</div>
             </div>
        </div>
        <hr class="my-1 border-border-color" />
        <div class="table-menu-item text-red-500" data-action="delete-col"><i data-feather="trash-2"></i>Delete Column</div>
    </div>
</div>
<div id="checklist-edit-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-lg z-50 transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header class="flex justify-between items-center mb-4 flex-shrink-0">
        <h3 class="text-lg font-semibold flex items-center gap-2">
            <i data-feather="check-square" class="w-5 h-5 text-accent-primary"></i>
            <span>Edit Checklist</span>
        </h3>
        <button id="checklist-modal-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>

    <div class="mb-4 flex-shrink-0">
        <label for="checklist-modal-title-input" class="text-sm font-medium text-text-secondary">Checklist Title</label>
        <input type="text" id="checklist-modal-title-input" class="w-full mt-1 bg-bg-pane-dark border border-border-color rounded-md p-2 focus:ring-2 focus:ring-accent-primary focus:outline-none" />
    </div>

    <div id="checklist-modal-items" class="flex-grow space-y-2 overflow-y-auto custom-scrollbar pr-2">
        </div>

    <div class="mt-4 flex-shrink-0">
        <button id="checklist-modal-add-item-btn" class="w-full flex items-center justify-center gap-2 p-2 rounded-md text-sm text-text-secondary hover:bg-bg-pane-dark transition-colors">
            <i data-feather="plus" class="w-4 h-4"></i>
            <span>Add Item</span>
        </button>
    </div>

    <footer class="flex justify-end gap-3 mt-6 flex-shrink-0">
        <button id="checklist-modal-cancel-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80">Cancel</button>
        <button id="checklist-modal-save-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90">Save Changes</button>
    </footer>
</div>
<!-- END: New Table Context Menu -->
 <div id="version-history-modal" class="modal hidden fixed inset-0 md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 bg-bg-pane-light md:rounded-lg shadow-2xl w-screen h-screen md:w-[90vw] md:max-w-6xl md:h-[80vh] z-[999] transition-all duration-300 transform scale-95 opacity-0 flex flex-col md:border-2 border-border-color">
    <header class="flex justify-between items-center p-4 border-b border-border-color flex-shrink-0">
        <h3 class="text-lg font-semibold flex items-center gap-2">
            <i data-feather="history" class="w-5 h-5 text-accent-primary"></i>
            <span id="version-history-title">Version History</span>
        </h3>
        <div class="flex items-center gap-3">
            <button id="version-restore-btn" class="brand-button text-sm">Restore</button>
            <button id="version-history-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
        </div>
    </header>
    

    <div class="flex flex-col md:flex-row flex-grow min-h-0">
        <div id="version-sidebar" class="w-full md:w-80 bg-bg-pane-dark p-2 flex flex-col flex-shrink-0 border-b md:border-b-0 md:border-r border-border-color">
            <div class="p-1 flex-shrink-0 hidden md:block">
                <button id="compare-versions-btn" class="w-full text-sm brand-button opacity-50" disabled="">
                    <i data-feather="git-pull-request" class="w-4 h-4 mr-2"></i>Compare Selected
                </button>
            </div>
            <div class="p-1 pt-2 flex-shrink-0">
                <div class="relative">
                    <i data-feather="search" class="absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-text-tertiary"></i>
                    <input type="text" id="version-search-input" placeholder="Search versions..." class="w-full bg-bg-main border border-border-color rounded-md py-1 pl-8 pr-2 text-sm focus:outline-none focus:ring-1 focus:ring-accent-primary" />
                </div>
            </div>
            <div id="version-list-container" class="space-y-1 overflow-y-auto custom-scrollbar flex-grow h-48 md:h-auto">
                </div>
        </div>

        <div id="version-content-viewer" class="flex-grow p-6 overflow-y-auto custom-scrollbar prose max-w-none">
            </div>
    </div>
</div>
<div id="properties-menu" class="context-menu fixed z-50 bg-bg-pane-light shadow-2xl rounded-md p-2 w-48 border border-border-color hidden origin-top-left scale-95 opacity-0 text-sm">
    <div class="text-xs text-text-tertiary px-2 pt-1 pb-2 font-semibold uppercase">Property Type</div>
    <button data-prop-type="text" class="w-full text-left px-3 py-1.5 hover:bg-bg-pane-dark rounded flex items-center gap-2">
        <i data-feather="type" class="w-4 h-4"></i>Text
    </button>
    <button data-prop-type="number" class="w-full text-left px-3 py-1.5 hover:bg-bg-pane-dark rounded flex items-center gap-2">
        <i data-feather="hash" class="w-4 h-4"></i>Number
    </button>
    <button data-prop-type="date" class="w-full text-left px-3 py-1.5 hover:bg-bg-pane-dark rounded flex items-center gap-2">
        <i data-feather="calendar" class="w-4 h-4"></i>Date
    </button>
    <button data-prop-type="select" class="w-full text-left px-3 py-1.5 hover:bg-bg-pane-dark rounded flex items-center gap-2">
        <i data-feather="chevron-down" class="w-4 h-4"></i>Select
    </button>
    <button data-prop-type="image" class="w-full text-left px-3 py-1.5 hover:bg-bg-pane-dark rounded flex items-center gap-2">
    <i data-feather="image" class="w-4 h-4"></i>Image URL
</button>

</div>
<div id="select-property-menu" class="context-menu fixed z-[60] bg-bg-pane-light shadow-2xl rounded-md p-2 w-56 border border-border-color hidden origin-top-left scale-95 opacity-0 text-sm flex flex-col">
    <div class="px-2 pb-1">
        <input type="text" id="select-property-filter" placeholder="Find or create an option..." class="w-full bg-bg-main border border-border-color rounded-md py-1 px-2 text-sm focus:outline-none focus:ring-1 focus:ring-accent-primary" />
    </div>
    <div id="select-property-options" class="flex-grow overflow-y-auto custom-scrollbar space-y-1 py-1">
        </div>
</div>
<div id="add-property-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-md z-50 transition-all duration-300 transform scale-95 opacity-0">
    <header class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold">Add New Property</h3>
        <button id="add-property-modal-close-btn" class="p-2 -mr-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>

    <div class="space-y-4">
        <div>
            <label for="new-prop-name-input" class="text-sm font-medium text-text-secondary">Property Name</label>
            <input type="text" id="new-prop-name-input" placeholder="e.g., Status, Priority..." class="w-full mt-1 bg-bg-pane-dark border border-border-color rounded-md p-2 focus:ring-2 focus:ring-accent-primary focus:outline-none" />
        </div>
        <div>
            <label class="text-sm font-medium text-text-secondary">Property Type</label>
            <div id="new-prop-type-selector" class="grid grid-cols-2 gap-2 mt-2">
                <label class="prop-type-option"><input type="radio" name="prop-type" value="text" checked="" /><span><i data-feather="type"></i>Text</span></label>
                <label class="prop-type-option"><input type="radio" name="prop-type" value="number" /><span><i data-feather="hash"></i>Number</span></label>
                <label class="prop-type-option"><input type="radio" name="prop-type" value="date" /><span><i data-feather="calendar"></i>Date</span></label>
                <label class="prop-type-option"><input type="radio" name="prop-type" value="select" /><span><i data-feather="chevron-down"></i>Select</span></label>
                <label class="prop-type-option"><input type="radio" name="prop-type" value="image" /><span><i data-feather="image"></i>Image URL</span></label>
            </div>
        </div>
        
        <div id="new-prop-value-container" class="hidden">
            <label for="new-prop-value-input" class="text-sm font-medium text-text-secondary">Initial Value</label>
            <div id="new-prop-value-input-wrapper" class="mt-1"></div>
        </div>

        <p id="add-property-error" class="text-red-500 text-sm h-5"></p>
    </div>

    <footer class="flex justify-end gap-3 mt-6">
        <button id="add-property-cancel-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80">Cancel</button>
        <button id="create-property-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90">Create Property</button>
    </footer>
</div>
<div id="notion-style-mobile-menu" class="fixed inset-0 bg-bg-pane-light z-[1000] flex flex-col transition-transform duration-300 ease-in-out -translate-x-full">
    
    <header class="relative flex justify-between items-center p-4 border-b border-border-color flex-shrink-0">
    <div id="mobile-menu-profile-activator" class="flex items-center gap-3 cursor-pointer">
        <button class="w-8 h-8 rounded-full bg-gradient-to-r from-[var(--brand-grad-from)] to-[var(--brand-grad-to)] flex items-center justify-center font-bold text-white pointer-events-none">
            <div id="menu-user-initial">R</div>
        </button>
        <div>
            <div id="menu-workspace-title" class="font-semibold text-text-primary">Workspace</div>
            <div id="menu-user-email" class="text-xs text-text-secondary"></div>
        </div>
    </div>
    <button id="mobile-menu-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark">
        <i data-feather="x" class="w-6 h-6"></i>
    </button>

    <div id="mobile-profile-dropdown" class="dropdown-menu hidden absolute top-full left-4 mt-2 w-60 bg-bg-pane-dark shadow-2xl rounded-md p-1 border border-border-color origin-top-left z-20">
        <div class="px-2 py-2 border-b border-border-color">
            <p class="text-sm font-semibold text-text-primary">Signed in as</p>
            <p id="dropdown-user-email-display" class="text-sm text-text-secondary truncate"></p>
        </div>
        <div class="p-1">
            <a href="#" id="mobile-sign-out-link" class="w-full text-left px-2 py-1.5 text-sm hover:bg-bg-main text-red-500 rounded flex items-center gap-2">
                <i data-feather="log-out" class="w-4 h-4"></i>
                <span>Sign Out</span>
            </a>
        </div>
    </div>
</header>

    <div id="notion-menu-content" class="flex-grow overflow-y-auto custom-scrollbar p-2">
        <div id="jump-back-in-section" class="p-2"></div>

        <div id="private-section" class="p-2"></div>
    </div>
<footer class="flex justify-around items-center p-2 border-t border-border-color flex-shrink-0">
    <button id="mobile-menu-settings-btn" class="flex-1 flex flex-col items-center justify-center gap-1 p-2 rounded-lg hover:bg-bg-pane-dark text-text-secondary">
        <i data-feather="settings" class="w-5 h-5"></i>
        <span class="text-xs">Settings</span>
    </button>
    <button id="mobile-menu-tags-btn" class="flex-1 flex flex-col items-center justify-center gap-1 p-2 rounded-lg hover:bg-bg-pane-dark text-text-secondary">
        <i data-feather="tag" class="w-5 h-5"></i>
        <span class="text-xs">Tags</span>
    </button>
    <button id="mobile-menu-agents-btn" class="flex-1 flex flex-col items-center justify-center gap-1 p-2 rounded-lg hover:bg-bg-pane-dark text-text-secondary">
        <i data-feather="box" class="w-5 h-5"></i>
        <span class="text-xs">Agents</span>
    </button>
    <button id="mobile-menu-add-folder-btn" class="flex-1 flex flex-col items-center justify-center gap-1 p-2 rounded-lg hover:bg-bg-pane-dark text-text-secondary">
        <i data-feather="folder-plus" class="w-5 h-5"></i>
        <span class="text-xs">New Folder</span>
    </button>
</footer>

</div>
<div id="mobile-settings-popup" class="fixed inset-0 bg-bg-pane-light z-[1001] flex flex-col transition-transform duration-300 ease-in-out translate-x-full">
    
    <header class="flex items-center p-4 border-b border-border-color flex-shrink-0">
        <button id="mobile-settings-back-btn" class="p-2 -ml-2 rounded-full hover:bg-bg-pane-dark">
            <i data-feather="arrow-left" class="w-6 h-6"></i>
        </button>
        <h3 class="text-lg font-semibold ml-2">Settings</h3>
    </header>

    <div id="mobile-settings-content" class="flex-grow overflow-y-auto custom-scrollbar p-2">
        <div class="space-y-1 p-2">
            <button id="mobile-theme-toggle" class="w-full text-left px-3 py-3 text-base hover:bg-bg-pane-dark rounded-lg flex items-center gap-4 text-text-primary">
               <i data-feather="star" id="mobile-theme-icon" class="w-5 h-5"></i>
               <span id="mobile-theme-text">Reputify Theme</span>
            </button>
            <button data-action="import" class="w-full text-left px-3 py-3 text-base hover:bg-bg-pane-dark rounded-lg flex items-center gap-4 text-text-primary">
                <i data-feather="upload" class="w-5 h-5"></i>
                <span>Import Data</span>
            </button>
            <button data-action="export" class="w-full text-left px-3 py-3 text-base hover:bg-bg-pane-dark rounded-lg flex items-center gap-4 text-text-primary">
                <i data-feather="download" class="w-5 h-5"></i>
                <span>Export Data</span>
            </button>
            <div id="mobile-chatbot-toggle" class="w-full text-left px-3 py-3 text-base rounded-lg flex items-center justify-between gap-4 text-text-primary cursor-pointer hover:bg-bg-pane-dark">
                <div class="flex items-center gap-4">
                    <i data-feather="message-square" class="w-5 h-5"></i>
                    <span>Show Chatbot Button</span>
                </div>
                <div class="toggle-switch" data-setting="chatbotVisible">
                    <div class="toggle-knob"></div>
                </div>
            </div>
            <button id="mobile-bookmarklet-btn" class="w-full text-left px-3 py-3 text-base hover:bg-bg-pane-dark rounded-lg flex items-center gap-4 text-text-primary">
                <i data-feather="book" class="w-5 h-5"></i>
                <span>Web Clipper</span>
            </button>
            <div id="mobile-properties-toggle" class="w-full text-left px-3 py-3 text-base rounded-lg flex items-center justify-between gap-4 text-text-primary cursor-pointer hover:bg-bg-pane-dark">
                <div class="flex items-center gap-4">
                    <i data-feather="eye" class="w-5 h-5"></i>
                    <span>Hide Properties</span>
                </div>
                <div class="toggle-switch" data-setting="propertiesVisible">
                    <div class="toggle-knob"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="mobile-tags-popup" class="fixed inset-0 bg-bg-pane-light z-[1001] flex flex-col transition-transform duration-300 ease-in-out translate-x-full">
    
    <header class="flex items-center p-4 border-b border-border-color flex-shrink-0">
        <button id="mobile-tags-back-btn" class="p-2 -ml-2 rounded-full hover:bg-bg-pane-dark">
            <i data-feather="arrow-left" class="w-6 h-6"></i>
        </button>
        <h3 class="text-lg font-semibold ml-2">Tags</h3>
    </header>

    <div id="mobile-tags-content" class="flex-grow overflow-y-auto custom-scrollbar p-2">
        </div>
</div>
<div id="assign-note-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-4 rounded-lg shadow-2xl w-[90vw] max-w-lg z-50 transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header class="flex justify-between items-center mb-3 flex-shrink-0">
        <h3 id="assign-note-modal-title" class="text-lg font-semibold">Assign Note to Date</h3>
        <button id="assign-note-modal-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>
    <div class="relative flex-shrink-0 mb-2">
        <i data-feather="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-text-tertiary"></i>
        <input type="text" id="assign-note-search-input" placeholder="Search notes in this project..." class="w-full bg-bg-main border border-border-color rounded-md py-2 pl-9 pr-3 text-sm focus:outline-none focus:ring-1 focus:ring-accent-primary" />
    </div>
    <div id="assign-note-duration-wrapper" class="relative flex-shrink-0 mb-2">
    <label for="assign-note-duration-input" class="text-sm font-medium text-text-secondary">Duration</label>
    <input type="text" id="assign-note-duration-input" placeholder="e.g., 30m, 1.5h, 90 (defaults to 1 hour)" class="w-full mt-1 bg-bg-main border border-border-color rounded-md py-2 px-3 text-sm focus:outline-none focus:ring-1 focus:ring-accent-primary" />
</div>
    <div id="assign-note-list" class="flex-grow overflow-y-auto custom-scrollbar -mr-2 pr-2">
        </div>
</div>
<div id="chatbot-context-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-4 rounded-lg shadow-2xl w-[90vw] max-w-lg z-[1000] transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header class="flex justify-between items-center mb-3 flex-shrink-0">
        <h3 class="text-lg font-semibold flex items-center gap-2"><i data-feather="file-plus" class="w-5 h-5 text-accent-primary"></i>Add Context from Notes</h3>
        <button id="chatbot-context-modal-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>
    <div class="relative flex-shrink-0 mb-2">
        <i data-feather="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-text-tertiary"></i>
        <input type="text" id="chatbot-context-search-input" placeholder="Search notes..." class="w-full bg-bg-main border border-border-color rounded-md py-2 pl-9 pr-3 text-sm focus:outline-none focus:ring-1 focus:ring-accent-primary" />
    </div>
    <div id="chatbot-context-note-list" class="flex-grow overflow-y-auto custom-scrollbar -mr-2 pr-2 space-y-1">
        </div>
    <footer class="flex justify-end gap-3 mt-4 flex-shrink-0">
        <button id="chatbot-context-cancel-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80">Cancel</button>
        <button id="chatbot-context-confirm-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90">Add Context</button>
    </footer>
</div>
<div id="calculator-modal" class="modal hidden fixed top-1/4 left-1/2 -translate-x-1/2 bg-bg-pane-dark p-3 rounded-lg shadow-2xl w-[280px] z-[1001] transition-all duration-300 transform scale-95 opacity-0 flex flex-col" style="resize: both; overflow: hidden;">
    <header id="calculator-header" class="flex justify-between items-center pb-2 mb-2 border-b border-border-color cursor-move flex-shrink-0">
        <h3 class="text-sm font-semibold flex items-center gap-2">
            <i data-feather="cpu" class="w-4 h-4 text-accent-primary"></i>
            <span>Calculator</span>
        </h3>
        <button id="calculator-close-btn" class="p-1 rounded-full hover:bg-bg-main"><i data-feather="x" class="w-4 h-4"></i></button>
    </header>
    <div class="flex-grow flex flex-col gap-3">
        <input type="text" id="calculator-display" class="w-full bg-bg-main text-right text-3xl font-light p-3 rounded-md border border-border-color focus:outline-none focus:ring-2 focus:ring-accent-primary" readonly="" />
        <div id="calculator-buttons" class="grid grid-cols-4 gap-2">
            <button class="calc-btn bg-bg-pane-light">C</button>
            <button class="calc-btn bg-bg-pane-light">CE</button>
            <button class="calc-btn bg-bg-pane-light">%</button>
            <button class="calc-btn operator-btn">/</button>
            <button class="calc-btn">7</button>
            <button class="calc-btn">8</button>
            <button class="calc-btn">9</button>
            <button class="calc-btn operator-btn">*</button>
            <button class="calc-btn">4</button>
            <button class="calc-btn">5</button>
            <button class="calc-btn">6</button>
            <button class="calc-btn operator-btn">-</button>
            <button class="calc-btn">1</button>
            <button class="calc-btn">2</button>
            <button class="calc-btn">3</button>
            <button class="calc-btn operator-btn">+</button>
            <button class="calc-btn col-span-2">0</button>
            <button class="calc-btn">.</button>
            <button class="calc-btn equals-btn">=</button>
        </div>
    </div>
</div>
<div id="template-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-4 rounded-lg shadow-2xl w-[90vw] max-w-2xl z-50 transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header class="flex justify-between items-center mb-3 flex-shrink-0">
        <h3 class="text-lg font-semibold flex items-center gap-2">
            <i data-feather="file-plus" class="w-5 h-5 text-accent-primary"></i>
            <span>Create from Template</span>
        </h3>
        <button id="template-modal-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>
    <div class="relative flex-shrink-0 mb-2">
        <i data-feather="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-text-tertiary"></i>
        <input type="text" id="template-search-input" placeholder="Search templates..." class="w-full bg-bg-main border border-border-color rounded-md py-2 pl-9 pr-3 text-sm focus:outline-none focus:ring-1 focus:ring-accent-primary" />
    </div>
    <div id="template-list-container" class="flex-grow overflow-y-auto custom-scrollbar -mr-2 pr-2 grid grid-cols-1 md:grid-cols-2 gap-2">
        </div>
    <footer class="flex justify-end gap-3 mt-4 flex-shrink-0 border-t border-border-color pt-3">
         <button id="manage-templates-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80 text-sm">Manage Templates</button>
    </footer>
</div>
<div id="manage-templates-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-4 rounded-lg shadow-2xl w-[90vw] max-w-lg z-[999] transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header class="flex justify-between items-center mb-3 flex-shrink-0">
        <h3 class="text-lg font-semibold flex items-center gap-2">
            <i data-feather="edit" class="w-5 h-5 text-accent-primary"></i>
            <span>Manage Templates</span>
        </h3>
        <button id="manage-templates-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>
    <div id="manage-template-list" class="flex-grow overflow-y-auto custom-scrollbar -mr-2 pr-2 space-y-2 max-h-[60vh]">
        </div>
    <footer class="flex justify-end gap-3 mt-4 flex-shrink-0 border-t border-border-color pt-3">
         <button id="manage-templates-done-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90 text-sm">Done</button>
    </footer>
</div>
<div id="timer-modal" class="modal hidden fixed top-1/4 left-1/2 -translate-x-1/2 bg-bg-pane-dark p-3 rounded-lg shadow-2xl w-[280px] z-[1001] transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header id="timer-header" class="flex justify-between items-center pb-2 mb-2 border-b border-border-color cursor-move flex-shrink-0">
        <h3 class="text-sm font-semibold flex items-center gap-2">
            <i data-feather="clock" class="w-4 h-4 text-accent-primary"></i>
            <span>Timer / Stopwatch</span>
        </h3>
        <button id="timer-close-btn" class="p-1 rounded-full hover:bg-bg-main"><i data-feather="x" class="w-4 h-4"></i></button>
    </header>
    <div class="flex-grow flex flex-col gap-3">
        <div id="timer-display" class="w-full bg-bg-main text-center text-5xl font-light p-3 rounded-md border border-border-color tracking-wider">00:00:00</div>
        
        <div id="timer-input-container" class="flex gap-2">
            <input type="text" id="timer-input" placeholder="e.g., 15m, 1.5h" class="w-full bg-bg-pane-light border border-border-color rounded-md p-2 focus:ring-2 focus:ring-accent-primary focus:outline-none" />
            <button id="timer-set-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90">Set</button>
        </div>

        <div id="timer-controls" class="grid grid-cols-2 gap-2">
            <button id="timer-start-stop-btn" class="calc-btn brand-button col-span-2">Start</button>
            <button id="timer-reset-btn" class="calc-btn bg-bg-pane-light">Reset</button>
            <button id="timer-lap-btn" class="calc-btn bg-bg-pane-light" disabled="">Lap</button>
        </div>
        <div id="timer-laps-container" class="text-xs text-text-secondary max-h-24 overflow-y-auto custom-scrollbar space-y-1 p-1"></div>
    </div>
</div>
<div id="invitation-toast-container" class="fixed bottom-4 right-4 z-[1001] flex flex-col items-end gap-3">
    </div>
<div id="share-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-lg z-50 transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header class="flex justify-between items-center mb-4 flex-shrink-0">
        <h3 class="text-lg font-semibold flex items-center gap-2">
            <i data-feather="users" class="w-5 h-5 text-accent-primary"></i>
            <span>Share Note</span>
        </h3>
        <button id="share-modal-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>

    <div class="mb-4">
        <label for="share-email-input" class="text-sm font-medium text-text-secondary">Invite by Email</label>
        <div class="flex items-center gap-2 mt-1">
            <input type="email" id="share-email-input" placeholder="person@example.com" class="flex-grow bg-bg-pane-dark border border-border-color rounded-md p-2 focus:ring-2 focus:ring-accent-primary focus:outline-none" />
            <button id="share-invite-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90">Invite</button>
        </div>
        <p id="share-error" class="text-red-500 text-sm h-5 mt-1"></p>
    </div>

    <div class="flex-grow space-y-2 overflow-y-auto custom-scrollbar -mr-3 pr-3">
        <h4 class="text-sm font-semibold text-text-secondary">Shared With</h4>
        <div id="share-collaborators-list">
            </div>
    </div>

    <footer class="flex justify-end gap-3 mt-6 flex-shrink-0 pt-4 border-t border-border-color">
        <button id="share-done-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80">Done</button>
    </footer>
</div>
<div id="sharing-management-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-lg z-50 transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header class="flex justify-between items-center mb-4 flex-shrink-0">
        <h3 class="text-lg font-semibold flex items-center gap-2"><i data-feather="share-2" class="w-5 h-5 text-accent-primary"></i>Manage Sharing</h3>
        <button id="sharing-modal-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>

    <div class="flex-grow overflow-y-auto custom-scrollbar -mr-3 pr-3 space-y-4 max-h-[60vh]">
        <div id="shared-by-me-section">
            <h4 class="font-semibold text-text-secondary mb-2">Notes You Are Sharing</h4>
            <div id="shared-by-me-list" class="space-y-2"></div>
        </div>
        <hr class="my-4 border-border-color" />
        <div id="shared-with-me-section">
            <h4 class="font-semibold text-text-secondary mb-2">Notes Shared With You</h4>
            <div id="shared-with-me-list" class="space-y-2"></div>
        </div>
    </div>
    
    <footer class="flex justify-end mt-6 flex-shrink-0 pt-4 border-t border-border-color">
        <button id="sharing-modal-done-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80">Done</button>
    </footer>
</div>
<div id="agent-list-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-2xl z-50 transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header class="flex justify-between items-center mb-4 flex-shrink-0">
        <h3 class="text-lg font-semibold flex items-center gap-2"><i data-feather="archive" class="w-5 h-5 text-accent-primary"></i>Your Saved Agents</h3>
        <button id="agent-list-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>
    <div id="agent-list-container" class="flex-grow space-y-2 overflow-y-auto custom-scrollbar max-h-[60vh]"></div>
    <footer class="flex justify-between items-center mt-4 flex-shrink-0">
        <button id="import-agent-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80 flex items-center gap-2 text-sm">
            <i data-feather="upload-cloud" class="w-4 h-4"></i>
            <span>Import Agent</span>
        </button>
        <button id="agent-list-done-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90">Done</button>
    </footer>
    <input type="file" id="agent-import-input" class="hidden" accept=".json" />
    
</div>
<div id="save-agent-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-md z-[51] transition-all duration-300 transform scale-95 opacity-0">
    <h3 class="text-lg font-semibold mb-4">Save Agent Blueprint</h3>
    <div class="space-y-4">
        <div>
            <label for="save-agent-name-input" class="text-sm font-medium text-text-secondary">Agent Name</label>
            <input id="save-agent-name-input" type="text" class="w-full mt-1 bg-bg-pane-dark border border-border-color rounded-md p-2 focus:ring-2 focus:ring-accent-primary focus:outline-none" placeholder="e.g., Google Review Agent" />
        </div>
        <div>
            <label for="save-agent-trigger-input" class="text-sm font-medium text-text-secondary">Run Command</label>
            <p class="text-xs text-text-tertiary">This is the unique command to trigger your agent.</p>
            <div class="relative mt-1">
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-tertiary">/run</span>
                <input id="save-agent-trigger-input" type="text" class="w-full bg-bg-pane-dark border border-border-color rounded-md p-2 pl-12 focus:ring-2 focus:ring-accent-primary focus:outline-none" placeholder="reviewagent" />
            </div>
        </div>
        <div>
            <label for="save-agent-argument-name-input" class="text-sm font-medium text-text-secondary">Command Argument (Optional)</label>
            <p class="text-xs text-text-tertiary">Define a placeholder for dynamic input. When you run <code class="text-accent-primary text-xs bg-bg-main px-1 rounded">/run reviewagent (your note name)</code>, the note name will replace this placeholder in your instructions.</p>
            <input id="save-agent-argument-name-input" type="text" class="w-full mt-1 bg-bg-pane-dark border border-border-color rounded-md p-2 focus:ring-2 focus:ring-accent-primary focus:outline-none" placeholder="{{note_name}}" />
        </div>
        <p id="save-agent-error" class="text-red-500 text-sm h-5"></p>
    </div>
    <div class="flex justify-end gap-3 mt-6">
        <button id="save-agent-cancel-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80">Cancel</button>
        <button id="save-agent-confirm-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90">Save Blueprint</button>
    </div>
</div>
<div id="agent-remap-modal" class="modal hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-bg-pane-light p-6 rounded-lg shadow-2xl w-[90vw] max-w-lg z-[1000] transition-all duration-300 transform scale-95 opacity-0 flex flex-col">
    <header class="flex justify-between items-center mb-4 flex-shrink-0">
        <h3 id="agent-remap-title" class="text-lg font-semibold flex items-center gap-2">
            <i data-feather="link" class="w-5 h-5 text-accent-primary"></i>
            <span>Import Agent</span>
        </h3>
        <button id="agent-remap-modal-close-btn" class="p-2 rounded-full hover:bg-bg-pane-dark"><i data-feather="x" class="w-5 h-5"></i></button>
    </header>

    <div id="agent-remap-content" class="flex-grow overflow-y-auto custom-scrollbar -mr-3 pr-3 space-y-4 max-h-[60vh]">
        <p class="text-text-secondary">Loading agent details...</p>
    </div>
    
    <footer class="flex justify-end gap-3 mt-6 flex-shrink-0 pt-4 border-t border-border-color">
        <button id="agent-remap-cancel-btn" class="px-4 py-2 rounded-md bg-bg-pane-dark hover:opacity-80">Cancel</button>
        <button id="agent-remap-confirm-btn" class="px-4 py-2 rounded-md brand-button hover:opacity-90">Confirm &amp; Import</button>
    </footer>
</div>


<script src="app.js"></script><script type="module" src="app.module.js"></script></body></html>
